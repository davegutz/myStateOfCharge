E: DS18, t=     0.0, ct=10, using lgv
0,  2022-06-24T07:37:52, 1656070672,  17.682,   8.841,   1.953,  1.0000,  0.9921,  13.509,  13.499,  -0.652,   0.454,
1,  2022-06-24T08:07:52, 1656072472,  17.687,   8.843,   0.288,  1.0000,  0.9992,  14.412,  14.400,  -0.652,   0.454,
2,  2022-06-24T08:37:52, 1656074272,  18.437,   9.218,   0.165,  1.0000,  0.9992,  14.401,  14.391,  -0.652,   0.454,
3,  2022-06-24T09:07:53, 1656076073,  19.557,   9.778,   0.227,  1.0000,  0.9992,  14.404,  14.397,  -0.652,   0.454,
4,  2022-06-24T09:37:53, 1656077873,  20.678,  10.339,   0.227,  1.0000,  0.9991,  14.396,  14.389,  -0.652,   0.454,
5,  2022-06-24T10:07:53, 1656079673,  21.755,  10.877,   0.288,  1.0000,  0.9990,  14.387,  14.381,  -0.652,   0.454,
6,  2022-06-24T10:37:53, 1656081473,  22.722,  11.361,   0.288,  1.0000,  0.9991,  14.400,  14.394,  -0.652,   0.454,
7,  2022-06-24T11:07:53, 1656083273,  23.645,  11.822,   0.227,  1.0000,  0.9989,  14.383,  14.378,  -0.652,   0.454,
8,  2022-06-24T11:37:53, 1656085073,  24.437,  12.218,   0.288,  1.0000,  0.9990,  14.396,  14.391,  -0.652,   0.454,
9,  2022-06-24T12:07:53, 1656086873,  25.222,  12.611,   0.288,  1.0000,  0.9988,  14.370,  14.365,  -0.652,   0.454,
10,  2022-06-24T12:37:53, 1656088673,  25.853,  12.927,   0.288,  1.0000,  0.9989,  14.387,  14.383,  -0.652,   0.454,
11,  2022-06-24T13:07:53, 1656090473,  26.375,  13.188,   0.288,  1.0000,  0.9988,  14.374,  14.370,  -0.652,   0.454,
12,  2022-06-24T13:37:53, 1656092273,  27.000,  13.500,   0.165,  1.0000,  0.9989,  14.400,  14.397,  -0.652,   0.454,
13,  2022-06-24T14:07:53, 1656094073,  27.625,  13.812,   0.350,  1.0000,  0.9988,  14.383,  14.378,  -0.652,   0.454,
14,  2022-06-24T14:37:53, 1656095873,  28.250,  14.125,   0.227,  1.0000,  0.9988,  14.387,  14.383,  -0.652,   0.454,
15,  2022-06-24T15:07:53, 1656097673,  28.915,  14.457,   0.165,  1.0000,  0.9988,  14.387,  14.384,  -0.652,   0.454,
16,  2022-06-24T15:37:54, 1656099474,  29.457,  14.728,   0.227,  1.0000,  0.9988,  14.393,  14.389,  -0.652,   0.454,
17,  2022-06-24T16:07:54, 1656101274,  29.625,  14.812,   0.042,  1.0000,  0.9988,  14.376,  14.373,  -0.652,   0.454,
18,  2022-06-24T16:37:54, 1656103074,  29.447,  14.723,   0.227,  1.0000,  0.9988,  14.379,  14.377,  -0.652,   0.454,
19,  2022-06-24T17:07:54, 1656104874,  29.120,  14.560,   0.103,  1.0000,  0.9985,  14.342,  14.339,  -0.652,   0.454,
20,  2022-06-24T17:37:54, 1656106674,  28.745,  14.373,   0.103,  1.0000,  0.9982,  14.312,  14.309,  -0.652,   0.454,
21,  2022-06-24T18:07:54, 1656108474,  28.370,  14.185,   0.042,  1.0000,  0.9984,  14.321,  14.319,  -0.652,   0.454,
22,  2022-06-24T18:37:54, 1656110274,  27.868,  13.934,  -0.018,  0.9999,  0.9984,  14.318,  14.316,  -0.652,   0.454,
23,  2022-06-24T19:07:54, 1656112074,  27.208,  13.604,  -0.080,  0.9999,  0.9982,  14.293,  14.291,  -0.652,   0.454,
24,  2022-06-24T19:37:54, 1656113874,  26.505,  13.252,  -0.142,  0.9999,  0.9972,  14.147,  14.147,  -0.652,   0.454,
25,  2022-06-24T20:07:54, 1656115674,  25.932,  12.966,  -0.203,  0.9999,  0.9959,  13.967,  13.967,  -0.652,   0.454,
26,  2022-06-24T20:37:54, 1656117474,  25.372,  12.686,  -0.265,  0.9999,  0.9943,  13.761,  13.762,  -0.652,   0.454,
27,  2022-06-24T21:07:54, 1656119274,  24.932,  12.466,  -0.315,  0.9998,  0.9932,  13.645,  13.648,  -0.702,   0.404,
28,  2022-06-24T21:37:55, 1656121075,  24.435,  12.217,  -0.315,  0.9999,  0.9924,  13.554,  13.557,  -0.702,   0.404,
29,  2022-06-24T22:07:55, 1656122875,  23.993,  11.997,  -0.253,  0.9999,  0.9918,  13.485,  13.488,  -0.702,   0.404,
30,  2022-06-24T22:37:55, 1656124675,  23.592,  11.796,  -0.253,  0.9999,  0.9911,  13.412,  13.415,  -0.702,   0.404,
31,  2022-06-24T23:07:55, 1656126475,  23.182,  11.591,  -0.253,  0.9999,  0.9909,  13.386,  13.389,  -0.702,   0.404,
32,  2022-06-24T23:37:55, 1656128275,  22.747,  11.373,  -0.253,  0.9999,  0.9904,  13.330,  13.333,  -0.702,   0.404,
33,  2022-06-25T00:07:55, 1656130075,  22.368,  11.184,  -0.253,  0.9999,  0.9901,  13.295,  13.299,  -0.702,   0.404,
34,  2022-06-25T00:37:55, 1656131875,  21.993,  10.997,  -0.253,  0.9999,  0.9764,  13.291,  13.295,  -0.702,   0.404,
35,  2022-06-25T01:07:55, 1656133675,  21.682,  10.841,  -0.253,  0.9998,  0.8918,  13.243,  13.248,  -0.702,   0.404,
36,  2022-06-25T01:37:55, 1656135475,  21.307,  10.653,  -0.253,  0.9999,  0.8567,  13.261,  13.265,  -0.702,   0.404,
37,  2022-06-25T02:07:55, 1656137275,  20.995,  10.498,  -0.253,  0.9999,  0.8335,  13.217,  13.222,  -0.702,   0.404,
38,  2022-06-25T02:37:55, 1656139075,  20.682,  10.341,  -0.253,  0.9998,  0.8214,  13.239,  13.243,  -0.702,   0.404,
39,  2022-06-25T03:07:56, 1656140876,  20.370,  10.185,  -0.253,  0.9999,  0.8174,  13.209,  13.213,  -0.702,   0.404,
40,  2022-06-25T03:37:56, 1656142676,  20.057,  10.028,  -0.253,  0.9999,  0.8157,  13.231,  13.235,  -0.702,   0.404,
41,  2022-06-25T04:07:56, 1656144476,  19.807,   9.903,  -0.253,  0.9998,  0.8163,  13.209,  13.213,  -0.702,   0.404,
42,  2022-06-25T04:37:56, 1656146276,  19.537,   9.768,  -0.253,  0.9999,  0.8184,  13.231,  13.235,  -0.702,   0.404,
43,  2022-06-25T05:07:56, 1656148076,  19.278,   9.639,  -0.253,  0.9999,  0.8211,  13.223,  13.226,  -0.702,   0.404,
44,  2022-06-25T05:37:56, 1656149876,  19.057,   9.528,  -0.253,  0.9997,  0.8252,  13.217,  13.222,  -0.702,   0.404,
45,  2022-06-25T06:07:56, 1656151676,  18.807,   9.403,   0.042,  0.9999,  0.8418,  13.219,  13.223,  -0.652,   0.454,
46,  2022-06-25T06:37:56, 1656153476,  18.618,   9.309,   2.508,  1.0000,  0.9906,  13.344,  13.342,  -0.652,   0.454,
47,  2022-06-25T07:07:56, 1656155276,  18.557,   9.278,   0.597,  1.0000,  0.9990,  14.378,  14.365,  -0.652,   0.454,
48,  2022-06-25T07:37:56, 1656157076,  19.050,   9.525,   0.967,  1.0000,  0.9992,  14.411,  14.400,  -0.652,   0.454,
49,  2022-06-25T08:07:57, 1656158877,  20.187,  10.093,  -0.080,  0.9941,  0.9974,  14.163,  14.155,  -0.652,   0.454,
50,  2022-06-25T08:37:57, 1656160677,  21.062,  10.531,  -0.142,  0.9976,  0.9972,  14.138,  14.133,  -0.652,   0.454,
51,  2022-06-25T09:07:57, 1656162477,  21.312,  10.656,   0.165,  1.0000,  0.9982,  14.276,  14.272,  -0.652,   0.454,
52,  2022-06-25T09:37:57, 1656164277,  21.573,  10.787,   0.103,  1.0000,  0.9991,  14.406,  14.402,  -0.652,   0.454,
53,  2022-06-25T10:07:57, 1656166077,  22.310,  11.155,   0.227,  1.0000,  0.9991,  14.401,  14.397,  -0.652,   0.454,
54,  2022-06-25T10:37:57, 1656167877,  23.117,  11.558,   0.227,  1.0000,  0.9991,  14.410,  14.407,  -0.652,   0.454,
55,  2022-06-25T11:07:57, 1656169677,  24.250,  12.125,  -0.142,  0.9897,  0.9967,  14.073,  14.072,  -0.652,   0.454,
56,  2022-06-25T11:37:57, 1656171477,  25.075,  12.537,   0.350,  1.0000,  0.9991,  14.404,  14.402,  -0.652,   0.454,
57,  2022-06-25T12:07:57, 1656173277,  26.325,  13.162,   0.103,  1.0000,  0.9989,  14.397,  14.394,  -0.652,   0.454,
58,  2022-06-25T12:37:57, 1656175077,  27.623,  13.812,   0.227,  1.0000,  0.9988,  14.379,  14.377,  -0.652,   0.454,
59,  2022-06-25T13:07:57, 1656176877,  28.785,  14.393,   0.227,  1.0000,  0.9988,  14.387,  14.385,  -0.652,   0.454,
60,  2022-06-25T13:37:57, 1656178677,  29.750,  14.875,   0.103,  1.0000,  0.9987,  14.371,  14.368,  -0.652,   0.454,
61,  2022-06-25T14:07:57, 1656180477,  30.665,  15.332,   0.350,  1.0000,  0.9988,  14.391,  14.388,  -0.652,   0.454,
62,  2022-06-25T14:37:57, 1656182277,  31.500,  15.750,   0.165,  1.0000,  0.9988,  14.383,  14.380,  -0.652,   0.454,
63,  2022-06-25T15:07:58, 1656184078,  32.312,  16.156,   0.288,  1.0000,  0.9988,  14.392,  14.388,  -0.652,   0.454,
64,  2022-06-25T15:37:58, 1656185878,  32.875,  16.438,   0.227,  1.0000,  0.9988,  14.392,  14.388,  -0.652,   0.454,
65,  2022-06-25T16:07:58, 1656187678,  33.187,  16.593,   0.165,  1.0000,  0.9986,  14.371,  14.367,  -0.652,   0.454,
66,  2022-06-25T16:37:58, 1656189478,  33.250,  16.625,   0.227,  1.0000,  0.9988,  14.401,  14.398,  -0.652,   0.454,
67,  2022-06-25T17:07:58, 1656191278,  33.312,  16.656,   0.103,  1.0000,  0.9987,  14.384,  14.381,  -0.652,   0.454,
68,  2022-06-25T17:37:58, 1656193078,  33.182,  16.591,   0.165,  1.0000,  0.9988,  14.393,  14.390,  -0.652,   0.454,
69,  2022-06-25T18:07:58, 1656194878,  32.932,  16.466,   0.165,  1.0000,  0.9986,  14.376,  14.373,  -0.652,   0.454,
70,  2022-06-25T18:37:58, 1656196678,  32.685,  16.343,   0.042,  1.0000,  0.9984,  14.338,  14.336,  -0.652,   0.454,
71,  2022-06-25T19:07:58, 1656198478,  32.118,  16.059,  -0.018,  0.9999,  0.9982,  14.304,  14.303,  -0.652,   0.454,
72,  2022-06-25T19:37:58, 1656200278,  31.315,  15.658,  -0.142,  0.9999,  0.9975,  14.207,  14.206,  -0.652,   0.454,
73,  2022-06-25T20:07:58, 1656202078,  30.557,  15.278,  -0.203,  0.9999,  0.9961,  14.001,  14.001,  -0.652,   0.454,
74,  2022-06-25T20:37:58, 1656203878,  29.868,  14.934,  -0.203,  0.9999,  0.9948,  13.824,  13.826,  -0.652,   0.454,
75,  2022-06-25T21:07:58, 1656205678,  29.243,  14.622,  -0.253,  0.9999,  0.9934,  13.674,  13.676,  -0.702,   0.404,
76,  2022-06-25T21:37:58, 1656207478,  28.662,  14.331,  -0.253,  0.9999,  0.9926,  13.588,  13.591,  -0.702,   0.404,
77,  2022-06-25T22:07:59, 1656209279,  28.120,  14.060,  -0.253,  0.9999,  0.9918,  13.507,  13.510,  -0.702,   0.404,
78,  2022-06-25T22:37:59, 1656211079,  27.555,  13.777,  -0.315,  0.9999,  0.9914,  13.460,  13.463,  -0.702,   0.404,
79,  2022-06-25T23:07:59, 1656212879,  27.057,  13.528,  -0.315,  0.9998,  0.9909,  13.399,  13.403,  -0.702,   0.404,
80,  2022-06-25T23:37:59, 1656214679,  26.557,  13.278,  -0.315,  0.9999,  0.9905,  13.357,  13.361,  -0.702,   0.404,
81,  2022-06-26T00:07:59, 1656216479,  26.120,  13.060,  -0.315,  0.9999,  0.9902,  13.326,  13.331,  -0.702,   0.404,
82,  2022-06-26T00:37:59, 1656218279,  25.682,  12.841,  -0.315,  0.9999,  0.9812,  13.292,  13.297,  -0.702,   0.404,
83,  2022-06-26T01:07:59, 1656220079,  25.252,  12.626,  -0.315,  0.9999,  0.8928,  13.283,  13.287,  -0.702,   0.404,
84,  2022-06-26T01:37:59, 1656221879,  24.868,  12.434,  -0.315,  0.9999,  0.8544,  13.232,  13.236,  -0.702,   0.404,
85,  2022-06-26T02:07:59, 1656223679,  24.493,  12.247,  -0.315,  0.9999,  0.8304,  13.262,  13.267,  -0.702,   0.404,
86,  2022-06-26T02:37:59, 1656225479,  24.123,  12.062,  -0.315,  0.9999,  0.8170,  13.218,  13.223,  -0.702,   0.404,
87,  2022-06-26T03:07:59, 1656227279,  23.807,  11.903,  -0.315,  0.9998,  0.8124,  13.236,  13.241,  -0.702,   0.404,
88,  2022-06-26T03:38:00, 1656229080,  23.495,  11.748,  -0.315,  0.9998,  0.8102,  13.223,  13.227,  -0.702,   0.404,
89,  2022-06-26T04:08:00, 1656230880,  23.243,  11.622,  -0.315,  0.9998,  0.8111,  13.244,  13.249,  -0.702,   0.404,
90,  2022-06-26T04:38:00, 1656232680,  23.002,  11.501,  -0.253,  0.9999,  0.8134,  13.227,  13.232,  -0.702,   0.404,
91,  2022-06-26T05:08:00, 1656234480,  22.807,  11.403,  -0.253,  0.9999,  0.8101,  13.231,  13.236,  -0.702,   0.404,
92,  2022-06-26T05:38:00, 1656236280,  22.618,  11.309,  -0.253,  0.9999,  0.8141,  13.223,  13.227,  -0.702,   0.404,
93,  2022-06-26T06:08:00, 1656238080,  22.493,  11.247,   0.042,  1.0000,  0.8326,  13.236,  13.239,  -0.652,   0.454,
94,  2022-06-26T06:38:00, 1656239880,  22.368,  11.184,   1.398,  1.0000,  0.9796,  13.295,  13.296,  -0.652,   0.454,
95,  2022-06-26T07:08:00, 1656241680,  22.368,  11.184,   3.372,  1.0000,  0.9911,  13.413,  13.407,  -0.652,   0.454,
96,  2022-06-26T07:38:00, 1656243480,  22.375,  11.188,   0.288,  1.0000,  0.9991,  14.404,  14.393,  -0.652,   0.454,
97,  2022-06-26T08:08:00, 1656245280,  22.983,  11.492,   0.042,  1.0000,  0.9990,  14.398,  14.388,  -0.652,   0.454,
98,  2022-06-26T08:38:00, 1656247080,  24.120,  12.060,   0.227,  1.0000,  0.9989,  14.383,  14.377,  -0.652,   0.454,
99,  2022-06-26T09:08:01, 1656248881,  25.353,  12.677,  -0.080,  0.9969,  0.9979,  14.241,  14.235,  -0.652,   0.454,
100,  2022-06-26T09:38:01, 1656250681,  26.228,  13.114,  -0.080,  0.9989,  0.9974,  14.179,  14.176,  -0.652,   0.454,
101,  2022-06-26T10:08:01, 1656252481,  26.875,  13.438,  -0.080,  0.9972,  0.9968,  14.094,  14.091,  -0.652,   0.454,
102,  2022-06-26T10:38:01, 1656254281,  27.562,  13.781,  -0.080,  0.9999,  0.9978,  14.230,  14.227,  -0.652,   0.454,
103,  2022-06-26T11:08:01, 1656256081,  28.215,  14.107,  -0.018,  0.9975,  0.9966,  14.063,  14.062,  -0.652,   0.454,
104,  2022-06-26T11:36:53, 1656257813,  28.965,  14.482,   0.227,  1.0000,  0.9988,  14.383,  14.383,  -0.652,   0.454,
105,  2022-06-26T12:06:53, 1656259613,  30.000,  15.000,  -7.110,  0.9549,  0.7659,  13.210,  13.210,  -0.652,   0.454,
106,  2022-06-26T12:36:53, 1656261413,  30.813,  15.407,  -3.842,  0.9113,  0.8237,  13.235,  13.235,  -0.652,   0.454,
107,  2022-06-26T13:06:53, 1656263213,  31.120,  15.560,  10.895,  0.9048,  0.9899,  13.280,  13.280,  -0.652,   0.454,
108,  2022-06-26T13:36:53, 1656265013,  31.562,  15.781,  11.142,  0.9597,  0.9906,  13.424,  13.424,  -0.652,   0.454,
109,  2022-06-26T14:06:53, 1656266813,  31.998,  15.999,  -0.080,  0.9999,  0.9982,  14.330,  14.330,  -0.652,   0.454,
i,  date,                time,    Tbatt, Vbatt, Ibatt, soc, soc_ekf, Voc_dyn, Voc, tweak_bias_amp, tweak_bias_noa,
self_talk:  new string = 'Pm'

Mon:BatteryMonitor::Battery:
  temp_c_ =          32.062;  //  deg C
 *rp_delt_q_ =         -0.1;  //  Coulombs
 *rp_t_last_ =         32.1;  // deg C
  dvoc_dt  =       0.004000;  //  V/deg C
  r_0 =            0.003000;  //  ohms
  r_ct =           0.001600;  //  ohms
  tau_ct =         0.200000;  //  s (=1/Rct/Cct)
  r_diff =         0.007700;  //  ohms
  tau_diff =      83.000000;  //  s (=1/Rdif/Cdif)
  r_sd =          70.000000;  //  ohms
  tau_sd =       18000000.0;  //  sec
  bms_off_ =              0;  // T=off
  dv_dsoc_=       98.417282;  // V/fraction
  ib_ =              -0.142;  // A
  Ib =               -0.142;  // Bank, A
  vb_ =              14.309;  // V
  Vb =               14.309;  // Bank, V
  voc_ =             14.311;  // V
  voc_stat_ =        14.291;  // V
  vsat_ =            13.828;  // V
  dv_dyn_ =          -0.002;  // V
  sr_ =               1.000;  // Resistance scalar
  dv_ =               0.010;  // Table hard adj, V
  dt_ =               0.500;  // Update time, s
 *rp_nP_ =             1.00;  // P parallel in bank, e.g. '2P1S'
 *rp_nS_ =             1.00;  // S series in bank, e.g. '2P1S'
 BatteryMonitor::BatteryMonitor:
  amp_hrs_remaining_ekf_ =   85.887;  // Discharge amp*time left if drain to q_ekf=0, A-h
  amp_hrs_remaining_wt_  =   86.063;  // Discharge amp*time left if drain soc_wt_ to 0, A-h
  EKF_converged =                 1;  // EKF is converged, T=converged
  q_ekf =                  333942.4;  // Filtered charge calculated by ekf, C
  soc_ekf =                  0.9981;  // Solved state of charge, fraction
  soc_wt_ =                  1.0000;  // Weighted selection of ekf state of charge and coulomb counter (0-1)
  tcharge =                   -24.0;  // Counted charging time to full, hr
  tcharge_ekf =               -24.0;  // Solved charging time to full from ekf, hr
  voc_filt_ =                14.311;  // Filtered charging voltage for saturation detect, V
  voc_stat_ =                14.291;  // Static model open circuit voltage from table (reference), V
  y_filt_ =                  -0.000;  // Filtered y_ residual from EKF, V
Mon::Coulombs:
  q_cap_rated_ = 360000.0;  // Rated capacity at t_rated, C
  q_cap_rated_scaled_ =  360000.0;  // Applied rated capacity at t_rated_, C
  q_capacity_ =  334575.0;  // Saturation charge at temperature, C
  q_ =           334574.9;  // Present charge available to use, except q_min_, C
  q_min_ =        24748.1;  // Estimated charge at low voltage shutdown, C
  delta_q            -0.1;  // Charge change since saturated, C
  soc_ =           1.0000;  // Fraction of saturation charge (q_capacity_) available (0-1);
  sat_ =                1;  // Indication that battery is saturated, T=saturated
  t_rated_ =         25.0;  // Rated temperature, deg C
  t_last =           32.1;  // Last battery temperature for rate limit memory, deg C
  t_rlim_ =         0.017;  // Tbatt rate limit, deg C / s
  resetting_ =          0;  // Flag to coordinate user testing of coulomb counters, T=performing an external reset of counter
  soc_min_ =       0.0740;  // Estimated soc where battery BMS will shutoff current, fraction
  mod_ =        Battleborn;  // Model type of battery chemistry e.g. Battleborn or LION
  mod_code_ =           0;  // Chemistry code integer
Coulombs::Chemistry:
  dqdt =          0.010;  // Change of charge with temperature, fraction/deg C (0.01 from literature)
  low_voc =      10.000;  // Volt threshold for BMS to turn off battery, V
  hys_cap =     360000.000;  // Cap of hysteresis, Farads
  v_sat =        13.850;  // Sat thresh at temp, V
  dvoc_dt =       0.004;  // Change of VOC with operating temperature in range 0 - 50 C V/deg C
  dv =            0.010;  // Adjustment for calibration error, V
  r_0 =          0.003000;  // Randles R0, ohms
  r_ct =         0.001600;  // Randles charge transfer resistance, ohms
  r_diff =       0.007700;  // Randles diffusion resistance, ohms
  tau_ct =        0.200;  // Randles charge transfer time constant, s (=1/Rct/Cct)
  tau_diff =     83.000;  // Randles diffusion time constant, s (=1/Rdif/Cdif)
  tau_sd =      18000000.000;  // Equivalent model for EKF reference.	Parasitic discharge time constant, sec
  r_sd =         70.000;  // Equivalent model for EKF reference.	Parasitic discharge equivalent, ohms
  r_ss =          0.012;  // Equivalent model for state space model initialization, ohms
  voc(t, soc):
    t=  {  5.000,  11.100,  20.000,  40.000, };
    soc={  0.000,   0.050,   0.100,   0.140,   0.170,   0.200,   0.250,   0.300,   0.400,   0.500,   0.600,   0.700,   0.800,   0.900,   0.990,   0.995,   1.000, };
    voc={
      {  4.000,   4.000,   6.000,   9.500,  11.700,  12.300,  12.500,  12.650,  12.820,  12.910,  12.980,  13.050,  13.110,  13.170,  13.220,  13.750,  14.450, },
      {  4.000,   4.000,   8.000,  11.600,  12.400,  12.600,  12.700,  12.800,  12.920,  13.010,  13.060,  13.110,  13.170,  13.200,  13.230,  13.760,  14.460, },
      {  4.000,   8.000,  12.200,  12.680,  12.730,  12.790,  12.810,  12.890,  13.000,  13.040,  13.090,  13.140,  13.210,  13.250,  13.270,  13.800,  14.500, },
      {  4.080,   8.080,  12.280,  12.760,  12.810,  12.870,  12.890,  12.970,  13.080,  13.120,  13.170,  13.220,  13.290,  13.330,  13.350,  13.880,  14.580, },
         };
  soc_min(temp_c):
    temp_c =  {  5.000,  11.100,  20.000,  40.000, };
    soc_min=  {  0.140,   0.120,   0.080,   0.070, };
  r(soc, dv):
    soc={0.000000, 0.500000, 1.000000, };
    dv ={ -0.900,  -0.700,  -0.500,  -0.300,   0.000,   0.300,   0.500,   0.700,   0.900, };
    r  ={
      { 0.000001,  0.064000,  0.050000,  0.036000,  0.015000,  0.024000,  0.030000,  0.046000,  0.000001, },
      { 0.000001,  0.000001,  0.050000,  0.036000,  0.015000,  0.024000,  0.030000,  0.000001,  0.000001, },
      { 0.000001,  0.000001,  0.000001,  0.036000,  0.015000,  0.024000,  0.000001,  0.000001,  0.000001, },
         };
Mon::StateSpace:
   A  =  [ -5.000000,  0.000000,
           0.000000, -0.012048];
   x  =  [ -0.000087, -0.000268];
   B  =  [  0.008000,  0.000000,
           0.000093,  0.000000];
   u  =  [ -0.142424, 14.308839];
   C  =  [ -1.000000, -1.000000];
   D  =  [ -0.003000,  1.000000];
   x_dot  =  [ -0.000703, -0.000010];
   y  =  [ 14.330924];
   AinvB =  [  0.001600,  0.000000,
           0.007700,  0.000000];
  ::Hysteresis:
  res_ =         0.0156;  // Null, Ohms
  cap_init_ =  360000.0;  // Farads
  cap_ =       360000.0;  // Farads
  tau_ =         5400.0;  // Null time const, sec
  ib_ =          -0.142;  // In, A
  ioc_ =          1.273;  // Out, A
  soc_ =         1.0000;  // Input
  res_ =          0.016;  // Variable value, ohms
  dv_dot_ =      -0.000;  // Calculated rate, V/s
  dv_hys_ =       0.020;  // Delta state, V
  disabled_ =         0;  // Disabled by input < 1e-5, T=disab
  rp.hys_scale=    1.00;  // Scalar on hys
Mon::EKF_1x1:
Inputs:
  z  =    14.2907;  // 1x1 input, =voc, dynamic predicted by other model, V
  R  =   0.010000;  // 1x1 Kalman state uncertainty
  Q  =   0.000001;  // 1x1 Kalman process uncertainty
  H  =     98.417;  // 1x1 Jacobian sensitivity dV/dSOC
Outputs:
  x  =     0.9981;  // 1x1 Kalman state variable = Vsoc (0-1 fraction)
  hx =    14.3120;  // Output of observation function h(x)
  y  =    -0.0213;  // 1x1 Residual z-hx, V
  P  =   0.000001;  // 1x1 Kalman uncertainty covariance
  K  =   0.006216;  // 1x1 Kalman gain
  S  =   0.025761;  // 1x1 system uncertainty

Sim:   rp.modeling = 0
self_talk:  new string = 'Ps'

Sim:   rp.modeling = 0
Sim:BatteryModel::Battery:
  temp_c_ =          32.062;  //  deg C
 *rp_delt_q_ =         -0.1;  //  Coulombs
 *rp_t_last_ =         32.1;  // deg C
  dvoc_dt  =       0.004000;  //  V/deg C
  r_0 =            0.003000;  //  ohms
  r_ct =           0.001600;  //  ohms
  tau_ct =         0.200000;  //  s (=1/Rct/Cct)
  r_diff =         0.007700;  //  ohms
  tau_diff =      83.000000;  //  s (=1/Rdif/Cdif)
  r_sd =          70.000000;  //  ohms
  tau_sd =       18000000.0;  //  sec
  bms_off_ =              0;  // T=off
  dv_dsoc_=      122.999096;  // V/fraction
  ib_ =              -0.142;  // A
  Ib =               -0.142;  // Bank, A
  vb_ =              14.577;  // V
  Vb =               14.577;  // Bank, V
  voc_ =             14.578;  // V
  voc_stat_ =        14.558;  // V
  vsat_ =            13.828;  // V
  dv_dyn_ =          -0.001;  // V
  sr_ =               1.000;  // Resistance scalar
  dv_ =               0.010;  // Table hard adj, V
  dt_ =               0.500;  // Update time, s
 *rp_nP_ =             1.00;  // P parallel in bank, e.g. '2P1S'
 *rp_nS_ =             1.00;  // S series in bank, e.g. '2P1S'
 BatteryModel::BatteryModel:
  sat_ib_max_ =        -0.142;  // Current cutback to be applied to modeled ib output, A
  sat_ib_null_ =        0.000;  // Current cutback value for voc=vsat, A
  sat_cutback_gain_ =  1000.0;  // Gain to retard ib when voc exceeds vsat, dimensionless
  model_cutback_ =          1;  // Gain to retard ib when voc exceeds vsat, dimensionless
  model_saturated_ =        1;  // Modeled current being limited on saturation cutback, T = cutback limited
  ib_sat_ =             0.500;  // Indicator of maximal cutback, T = cutback saturated
 *rp_s_cap_model_ =     1.000;  // Rated capacity scalar
Sim::Coulombs:
  q_cap_rated_ = 360000.0;  // Rated capacity at t_rated, C
  q_cap_rated_scaled_ =  360000.0;  // Applied rated capacity at t_rated_, C
  q_capacity_ =  334575.0;  // Saturation charge at temperature, C
  q_ =           345825.0;  // Present charge available to use, except q_min_, C
  q_min_ =        24748.1;  // Estimated charge at low voltage shutdown, C
  delta_q            -0.1;  // Charge change since saturated, C
  soc_ =           1.0000;  // Fraction of saturation charge (q_capacity_) available (0-1);
  sat_ =                1;  // Indication that battery is saturated, T=saturated
  t_rated_ =         25.0;  // Rated temperature, deg C
  t_last =           32.1;  // Last battery temperature for rate limit memory, deg C
  t_rlim_ =         0.017;  // Tbatt rate limit, deg C / s
  resetting_ =          0;  // Flag to coordinate user testing of coulomb counters, T=performing an external reset of counter
  soc_min_ =       0.0740;  // Estimated soc where battery BMS will shutoff current, fraction
  mod_ =        Battleborn;  // Model type of battery chemistry e.g. Battleborn or LION
  mod_code_ =           0;  // Chemistry code integer
Coulombs::Chemistry:
  dqdt =          0.010;  // Change of charge with temperature, fraction/deg C (0.01 from literature)
  low_voc =      10.000;  // Volt threshold for BMS to turn off battery, V
  hys_cap =     360000.000;  // Cap of hysteresis, Farads
  v_sat =        13.850;  // Sat thresh at temp, V
  dvoc_dt =       0.004;  // Change of VOC with operating temperature in range 0 - 50 C V/deg C
  dv =            0.010;  // Adjustment for calibration error, V
  r_0 =          0.003000;  // Randles R0, ohms
  r_ct =         0.001600;  // Randles charge transfer resistance, ohms
  r_diff =       0.007700;  // Randles diffusion resistance, ohms
  tau_ct =        0.200;  // Randles charge transfer time constant, s (=1/Rct/Cct)
  tau_diff =     83.000;  // Randles diffusion time constant, s (=1/Rdif/Cdif)
  tau_sd =      18000000.000;  // Equivalent model for EKF reference.	Parasitic discharge time constant, sec
  r_sd =         70.000;  // Equivalent model for EKF reference.	Parasitic discharge equivalent, ohms
  r_ss =          0.012;  // Equivalent model for state space model initialization, ohms
  voc(t, soc):
    t=  {  5.000,  11.100,  20.000,  40.000, };
    soc={  0.000,   0.050,   0.100,   0.140,   0.170,   0.200,   0.250,   0.300,   0.400,   0.500,   0.600,   0.700,   0.800,   0.900,   0.990,   0.995,   1.000, };
    voc={
      {  4.000,   4.000,   6.000,   9.500,  11.700,  12.300,  12.500,  12.650,  12.820,  12.910,  12.980,  13.050,  13.110,  13.170,  13.220,  13.750,  14.450, },
      {  4.000,   4.000,   8.000,  11.600,  12.400,  12.600,  12.700,  12.800,  12.920,  13.010,  13.060,  13.110,  13.170,  13.200,  13.230,  13.760,  14.460, },
      {  4.000,   8.000,  12.200,  12.680,  12.730,  12.790,  12.810,  12.890,  13.000,  13.040,  13.090,  13.140,  13.210,  13.250,  13.270,  13.800,  14.500, },
      {  4.080,   8.080,  12.280,  12.760,  12.810,  12.870,  12.890,  12.970,  13.080,  13.120,  13.170,  13.220,  13.290,  13.330,  13.350,  13.880,  14.580, },
         };
  soc_min(temp_c):
    temp_c =  {  5.000,  11.100,  20.000,  40.000, };
    soc_min=  {  0.140,   0.120,   0.080,   0.070, };
  r(soc, dv):
    soc={0.000000, 0.500000, 1.000000, };
    dv ={ -0.900,  -0.700,  -0.500,  -0.300,   0.000,   0.300,   0.500,   0.700,   0.900, };
    r  ={
      { 0.000001,  0.064000,  0.050000,  0.036000,  0.015000,  0.024000,  0.030000,  0.046000,  0.000001, },
      { 0.000001,  0.000001,  0.050000,  0.036000,  0.015000,  0.024000,  0.030000,  0.000001,  0.000001, },
      { 0.000001,  0.000001,  0.000001,  0.036000,  0.015000,  0.024000,  0.000001,  0.000001,  0.000001, },
         };
Sim::StateSpace:
   A  =  [ -5.000000,  0.000000,
           0.000000, -0.012048];
   x  =  [ -0.000045, -0.000266];
   B  =  [  0.008000,  0.000000,
           0.000093,  0.000000];
   u  =  [ -0.080757, 14.578090];
   C  =  [  1.000000,  1.000000];
   D  =  [  0.003000,  1.000000];
   x_dot  =  [ -0.000419, -0.000004];
   y  =  [ 14.577708];
   AinvB =  [  0.001600,  0.000000,
           0.007700,  0.000000];
  ::Hysteresis:
  res_ =         0.0156;  // Null, Ohms
  cap_init_ =  360000.0;  // Farads
  cap_ =       360000.0;  // Farads
  tau_ =         5400.0;  // Null time const, sec
  ib_ =          -0.142;  // In, A
  ioc_ =          1.273;  // Out, A
  soc_ =         1.0000;  // Input
  res_ =          0.016;  // Variable value, ohms
  dv_dot_ =      -0.000;  // Calculated rate, V/s
  dv_hys_ =       0.020;  // Delta state, V
  disabled_ =         0;  // Disabled by input < 1e-5, T=disab
  rp.hys_scale=    1.00;  // Scalar on hys
self_talk:  new string = 'Pr'

retained parameters (rp):
  debug =                     0;  // Level of debug printing
  delta_q =              -0.134;  // Coulomb Counter state for ekf, (-1 - 1)
  t_last =               32.062;  // Battery temperature past value for rate limit memory, deg C
  delta_q_model =          -0.1;  // Coulomb Counter state for model, (-1 - 1)
  t_last_model =         32.062;  // Battery temperature past value for rate limit memory, deg C
  ibatt_bias_amp =       -0.230;  // Calibrate amp current sensor, A
  ibatt_bias_noamp =     -0.570;  // Calibrate non-amplified current sensor, A
  ibatt_bias_all =        0.000;  // Bias all current sensors, A 
  ibatt_sel_noamp =           0;  // Use non-amplified sensor
  vbatt_bias =            0.000;  // Calibrate Vbatt, V
  modeling =                  0;  // Bit mapped modeling specification
  duty =                      0;  // Used in Test Mode to inject Fake shunt current (0 - uint32_t(255))
  amp =                   0.000;  // Injected amplitude, A pk (0-18.3)
  freq =                  0.000;  // Injected frequency, r/s (0-2*pi)
  type =                      0;  //  Injected waveform type.   0=sine, 1=square, 2=triangle
  inj_soft_bias =         0.000;  // Constant bias, A
  tbatt_bias =            0.000;  // Sensed temp bias, deg C
  s_cap_model =           1.000;  // Scalar on battery model size
  cutback_gain_scalar =   1.000;  // Scalar on battery model saturation cutback function
  isum =                      75;  // Summary location ptr.   Begins at -1
  delta_q_inf_amp =     -3708.0;  // delta_q since last reset
  delta_q_inf_noamp =   -5330.3;  // delta_q since last reset
  hys_scale =             1.000;  //  Hysteresis scalar
  tweak_bias_amp =       -0.652;  // Tweak calibration for amplified current
  tweak_bias_noamp =      0.455;  // Tweak calibration for non-amplified current
  nP =                     1.00;  // Number of parallel batteries in bank, e.g. '2P1S'
  nS =                     1.00;  // Number of series batteries in bank, e.g. '2P1S'
  mon_mod =                   0;  //  Monitor battery model for electrical chars.   0=Battleborn, 1=LION
  sim_mod =                   0;  //  Simulation battery model for electrical chars.   0=Battleborn, 1=LION

command parameters(cp):
  enable_wifi =            0;
  model_cutback =          1;
  model_saturated =        1;
  soft_reset =             0;
  write_summary =          0;
  ibatt_bias_amp =    -0.882;
  ibatt_bias_noamp =  -0.115;
  dc_dc_on =               0;
  serial1 =                0;
self_talk:  new string = 'Pt'

Mon::StateSpace:
   A  =  [ -5.000000,  0.000000,
           0.000000, -0.012048];
   x  =  [ -0.000087, -0.000268];
   B  =  [  0.008000,  0.000000,
           0.000093,  0.000000];
   u  =  [ -0.142424, 14.308839];
   C  =  [ -1.000000, -1.000000];
   D  =  [ -0.003000,  1.000000];
   x_dot  =  [ -0.000703, -0.000010];
   y  =  [ 14.330924];
   AinvB =  [  0.001600,  0.000000,
           0.007700,  0.000000];
  ::Hysteresis:
  res_ =         0.0156;  // Null, Ohms
  cap_init_ =  360000.0;  // Farads
  cap_ =       360000.0;  // Farads
  tau_ =         5400.0;  // Null time const, sec
  ib_ =          -0.142;  // In, A
  ioc_ =          1.273;  // Out, A
  soc_ =         1.0000;  // Input
  res_ =          0.016;  // Variable value, ohms
  dv_dot_ =      -0.000;  // Calculated rate, V/s
  dv_hys_ =       0.020;  // Delta state, V
  disabled_ =         0;  // Disabled by input < 1e-5, T=disab
  rp.hys_scale=    1.00;  // Scalar on hys

Sim::StateSpace:
   A  =  [ -5.000000,  0.000000,
           0.000000, -0.012048];
   x  =  [ -0.000045, -0.000266];
   B  =  [  0.008000,  0.000000,
           0.000093,  0.000000];
   u  =  [ -0.080757, 14.578090];
   C  =  [  1.000000,  1.000000];
   D  =  [  0.003000,  1.000000];
   x_dot  =  [ -0.000419, -0.000004];
   y  =  [ 14.577708];
   AinvB =  [  0.001600,  0.000000,
           0.007700,  0.000000];
  ::Hysteresis:
  res_ =         0.0156;  // Null, Ohms
  cap_init_ =  360000.0;  // Farads
  cap_ =       360000.0;  // Farads
  tau_ =         5400.0;  // Null time const, sec
  ib_ =          -0.142;  // In, A
  ioc_ =          1.273;  // Out, A
  soc_ =         1.0000;  // Input
  res_ =          0.016;  // Variable value, ohms
  dv_dot_ =      -0.000;  // Calculated rate, V/s
  dv_hys_ =       0.020;  // Delta state, V
  disabled_ =         0;  // Disabled by input < 1e-5, T=disab
  rp.hys_scale=    1.00;  // Scalar on hys
self_talk:  new string = 'PM'

Tweak::Shunt(Amp)::
  port_ =                0x49; // I2C port used by Acafruit_ADS1015
  bare_ =                   0; // If ADS to be ignored
  *cp_ibatt_bias_ =    -0.882; // Global bias, A
  v2a_s_ =            -246.67; // Selected shunt conversion gain, A/V
  vshunt_int_ =           -12; // Sensed shunt voltage, count
  ishunt_cal_ =        -0.142; // Sensed, calibrated ADC, A
Shunt(Amp)::Tweak(Amp)::
  gain_ =                 -0.000023; // Current correction to be made for charge error see 'N/Mg', A/Coulomb/day
  max_change_ =               0.050; // Maximum allowed change to calibration adjustment see 'N/MC', A
  max_tweak_ =                1.000; // Maximum allowed calibration adjustment see 'N/Mx', A
  rp_delta_q_inf_ =         -3708.0; // Charge infinity at past update see 'N/Mi', Coulombs
  delta_q_sat_present_ =        0.0; // Charge infinity at saturation, present see 'N/MP', Coulombs
  delta_q_sat_past_ =           0.0; // Charge infinity at saturation, past see 'N/Mp', Coulombs
  sat_ =                          1; // Indication that battery is saturated, T=saturated
  delta_hrs_ =             2.637824; // Time since last allowed saturation see 'N/Mz', hr
  time_to_wait =           6.000000; // Time to wait before allowing saturation see 'N/Mw', hr
  tweak_bias =               -0.652; // Bias on current see 'N/Mk', A
Shunt(Amp)::Adafruit_ADS1x15 (Amp):
 m_bitShift =      4;
 m_gain =       2048;
 s_gain =       1024;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (Amp):
  _addr =        0x49;
  _begun =          1;
  _maxBufferSize = 32;
self_talk:  new string = 'PN'

Tweak::Shunt(No Amp)::
  port_ =                0x48; // I2C port used by Acafruit_ADS1015
  bare_ =                   0; // If ADS to be ignored
  *cp_ibatt_bias_ =    -0.115; // Global bias, A
  v2a_s_ =            -1189.30; // Selected shunt conversion gain, A/V
  vshunt_int_ =           -1; // Sensed shunt voltage, count
  ishunt_cal_ =         0.033; // Sensed, calibrated ADC, A
Shunt(No Amp)::Tweak(No Amp)::
  gain_ =                 -0.000023; // Current correction to be made for charge error see 'N/Mg', A/Coulomb/day
  max_change_ =               0.050; // Maximum allowed change to calibration adjustment see 'N/MC', A
  max_tweak_ =                1.000; // Maximum allowed calibration adjustment see 'N/Mx', A
  rp_delta_q_inf_ =         -5330.3; // Charge infinity at past update see 'N/Mi', Coulombs
  delta_q_sat_present_ =        0.0; // Charge infinity at saturation, present see 'N/MP', Coulombs
  delta_q_sat_past_ =           0.0; // Charge infinity at saturation, past see 'N/Mp', Coulombs
  sat_ =                          1; // Indication that battery is saturated, T=saturated
  delta_hrs_ =             2.637827; // Time since last allowed saturation see 'N/Mz', hr
  time_to_wait =           6.000000; // Time to wait before allowing saturation see 'N/Mw', hr
  tweak_bias =                0.455; // Bias on current see 'N/Mk', A
Shunt(No Amp)::Adafruit_ADS1x15 (No Amp):
 m_bitShift =      4;
 m_gain =       2560;
 s_gain =       2560;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (No Amp):
  _addr =        0x48;
  _begun =          1;
  _maxBufferSize = 32;
Tb  =  32.062,
Vb  =  14.317,
Voc =  14.318,
voc_filt  =  14.311,
Vsat =  13.828,
Ib  =  -0.019,
soc_m =   1.0000,
soc_ekf=   0.9981,
soc =   1.0000,
soc_wt =   1.0000,
modeling = 0,
amp delta_q_inf =    -3708.0,
amp tweak_bias =  -0.652,
no amp delta_q_inf =    -5330.3,
no amp tweak_bias =   0.455,
E: DS18, t=     0.0, ct=10, using lgv
E: DS18, t=     0.0, ct=10, using lgv
