echo:  Xp9, 4
echo:  Xp9, 0
echo:  Dm1, 0
ShuntAmp.add    0.000 to   1.000
echo:  Dn1, 0
ShuntNoAmp.add   0.000 to   1.000
echo:  Xp0, 0
echo:  Xf0., 0
Injected freq set   0.000 Hz =   0.000 r/s
echo:  Xa0.XS, 0
Inj amp set   0.000 & inj_bias set   0.000
echo:  Mk1, 0
amp tweak_sclr   1.000 to   1.000
echo:  Nk1, 0
Noa tweak_sclr   1.000 to   1.000
echo:  Dn0.998500Xs1.0, 0
ShuntNoAmp.add   1.000 to   0.998
echo:  Di0, 0
rp.ib_bias_all   0.000 to   0.000
echo:  Dm0, 0
ShuntAmp.add    1.000 to   0.000
echo:  Dn0, 0
ShuntNoAmp.add   0.998 to   0.000
echo:  Dv0, 0
Sen->vb_add  -0.000 to   0.000
echo:  DT0, 0
Sen.Tb_noise_amp_   0.000 to   0.000
echo:  DV0.0, 0
Sen.Vb_noise_amp_   0.000 to   0.000
echo:  DI0, 0
I ? 'h'
echo:  Xu0, 0
Fail tb 0 to 0
echo:  Xv1., 0
Stale tb time sclr    1.0000 to    1.0000
echo:  Dr100, 0
ReadSensors 100 to 100
echo:  DP4, 0
Print interval 4 to 4
echo:  v0, 0
echo:  Bm0, 0
Mon chem 0 to 0
soft reset...
echo:  Bs0, 0
Sim chem 0 to 0
soft reset...
echo:  Xm15, 0
modeling 15 to 15
Modeling 15
tweak_test 1
mod_ib 1
mod_vb 1
mod_tb 1
echo:  Xts, 0
Set sin.  rp.type = 1
echo:  Ca1, 0
soc=  1.000, modeling = 15, delta_q=  0.000, soc_model=  1.0000,   delta_q_model=  0.000, soc_ekf=  1.0000, delta_q_ekf= -0.394,
soft reset...
echo:  W3, 0
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  Ri, 0
Amp chg CC -373119.1 to -390240.0
Amp dchg CC  390240.0 to  390240.0
Noa chg CC -373119.1 to -390240.0
Noa dchg CC  390240.0 to  390240.0
echo:  Mw0, 0
Amp->time_to_wait   6.000 to   0.000
echo:  Nw0, 0
Noa->time_to_wait   6.000 to   0.000
echo:  MC0.004, 0
Amp->max_change_   0.001000 to   0.004000
echo:  Mx0.04, 0
Amp->max_tweak   0.010 to   0.040
echo:  NC0.004, 0
Noa->max_change_   0.001000 to   0.004000
echo:  Nx0.04, 0
Noa->max_tweak   0.010 to   0.040
echo:  Mk1, 0
amp tweak_sclr   1.000 to   1.000
echo:  Nk1, 0
Noa tweak_sclr   1.000 to   1.000
echo:  DP2, 0
Print interval 4 to 2
echo:  Rb, 0
echo:  Pa, 0
echo:  Pm, 0
BM::Battery:
  temp_c= 25.000; dg C
 *rp_delt_q=       0.0;  C
 *rp_t_last=      25.0; dg C
  dvoc_dt=  0.004000; V/dg C
  r_0=  0.003000;  ohm
  r_ct =   0.001600;  ohm
  tau_ct=  0.200000;  s (=1/Rct/Cct)
  r_diff=  0.007700;  ohm
  tau_diff = 83.000000;  s (=1/Rdif/Cdif)
  r_sd =  70.000000;  ohm
  tau_sd=25000000.0;  s
  bms_off=0;
  dv_dsoc=122.984123; V/frac
  ib=  0.000; A
  Ib=  0.000; Bank, A
  vb= 14.450; V
  Vb= 14.450; Bank, V
  voc= 14.450; V
  voc_stat= 14.450; V
  vsat= 13.800; V
  dv_dyn=   0.000; V
  sr=  1.000; sclr
  dt=  0.100; s
 *rp_nP= 1.00; P bank, e.g. '2P1S'
 *rp_nS= 1.00; S bank, e.g. '2P1S'
 BM::BM:
  ah_rem_ekf_=105.690; A-h
  ah_rem_soc_=105.690; A-h
  EKF_conv=0;
  q_ekf=  390239.6; C
  soc_ekf=  1.0000; frac
  tcharge= 24.0; hr
  tcharge_ekf=  0.0; hr
  voc_filt= 14.400; V
  voc_stat= 14.450; V
  y_filt=  0.099; Res EKF, V
Coulombs:
 q_cap_rated= 390240.0; At t_rated, C
 q_cap_rated_scaled= 390240.0; Act at t_rated_, C
 q_capacity= 390240.0; Sat q at temp, C
 q= 390240.0; Avail, except q_min_, C
 q_min=   9756.0; Low volt shutdown, C
 delta_q      0.0; Change since sat, C
 soc=  1.0000; Frac of q_cap avail (0-1);
 sat=1; T=saturated
 t_rated= 25.0; Rated, dg C
 t_last= 25.0; past, dg C
 t_rlim=  0.017; Tb RL, deg C / s
 resetting=0; Coord user testing of CC
 soc_min=  0.0250; soc BMS shuts off
 mod=Battleborn; Chem e.g. Battleborn or LION
 mod_code=0; Chem code
 coul_eff=  0.99850; Coul Eff
Coulombs::Chemistry:
  dqdt=  0.010; frac/dg C
  low_voc=  9.000; BMS turn off, V
  hys_cap=360000.000; F
  v_sat= 13.850; V
  dvoc_dt=  0.004; V/dg C
  dvoc= -0.050; Cal err, V
  Randles:   r_0= 0.003000; R0, ohm
   r_ct= 0.001600; Chg trans, ohm
   r_diff= 0.007700; Diffusion, ohm
   tau_ct=  0.200; ct, s (=1/Rct/Cct)
   tau_diff= 83.000; diff, s (=1/Rdiff/Cdiff)
  tau_sd=25000000.000; EKF. Parasitic disch, s
  r_sd= 70.000; EKF. Parasitic disch, ohm
  r_ss=  0.012; SS init, ohm
  voc(t, soc):
    y={  5.000,  11.100,  20.000,  30.000,  40.000, };
    x={ -0.150,   0.000,   0.050,   0.100,   0.140,   0.170,   0.200,   0.250,   0.300,   0.400,   0.500,   0.600,   0.700,   0.800,   0.900,   0.990,   0.995,   1.000, };
    v={
      {  4.000,   4.000,   4.000,   4.000,  10.200,  11.700,  12.450,  12.700,  12.770,  12.900,  12.910,  12.980,  13.050,  13.110,  13.170,  13.220,  13.590,  14.450, },
      {  4.000,   4.000,   4.000,   9.500,  12.000,  12.500,  12.700,  12.800,  12.900,  12.960,  13.010,  13.060,  13.110,  13.170,  13.200,  13.230,  13.600,  14.460, },
      {  4.000,   4.000,  10.000,  12.600,  12.770,  12.850,  12.890,  12.950,  12.990,  13.030,  13.040,  13.090,  13.140,  13.210,  13.250,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,  12.000,  12.650,  12.750,  12.800,  12.850,  12.950,  13.000,  13.080,  13.120,  13.160,  13.200,  13.240,  13.260,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,   4.000,   4.000,  10.500,  11.930,  12.780,  12.830,  12.890,  12.970,  13.060,  13.100,  13.130,  13.160,  13.190,  13.200,  13.720,  14.500, },
      };
  soc_min(temp_c):
    x={  5.000,  11.100,  20.000,  30.000,  40.000, };
    v={  0.100,   0.070,   0.050,   0.000,   0.200, };
StateSpace:
  dt =  0.100000
   A  =  [ -5.000000,  0.000000,
           0.000000, -0.012048];
   x  =  [  0.000000,  0.000000];
   B  =  [  0.008000,  0.000000,
           0.000093,  0.000000];
   u  =  [  0.000000, 14.450000];
   C  =  [ -1.000000, -1.000000];
   D  =  [ -0.003000,  1.000000];
   x_dot  =  [  0.000000,  0.000000];
   y  =  [ 14.450000];
   AinvB =  [  0.001600,  0.000000,
           0.007700,  0.000000];
  ::Hysteresis:
  res=0.0150; Null, Ohm
  cap=  360000.0; F
  tau=    5400.0; Null, s
  ib=  0.000; In, A
  ioc=  0.000; Out, A
  soc=  1.0000; Input
  res=  0.015; Var, ohm
  dv_dot=  0.000; V/s
  dv_hys=  0.000; Delta state, V
  disabled=0; input < 1e-5
 *rp_hys_scale=  0.30; Slr
  r(soc, dv):
    y={  0.000,   0.500,   1.000, };
    x={ -0.900,  -0.700,  -0.500,  -0.300,   0.000,   0.300,   0.500,   0.700,   0.900, };
    v={
      {  0.000,   0.064,   0.050,   0.036,   0.015,   0.024,   0.030,   0.046,   0.000, },
      {  0.000,   0.000,   0.050,   0.036,   0.015,   0.024,   0.030,   0.000,   0.000, },
      {  0.000,   0.000,   0.000,   0.036,   0.015,   0.024,   0.000,   0.000,   0.000, },
      };
EKF_1x1:
Inputs:
  z  =    14.4500;  // 1x1 input, =voc, dynamic predicted by other model, V
  R  =   0.250000;  // 1x1 Kalman state uncertainty
  Q  =   0.000000;  // 1x1 Kalman process uncertainty
  H  =    122.984;  // 1x1 Jacobian sensitivity dV/dSOC
Outputs:
  x  =     1.0000;  // 1x1 Kalman state variable = Vsoc (0-1 fraction)
  hx =    14.4498;  // Output of observation function h(x)
  y  =     0.0002;  // 1x1 Residual z-hx, V
  P  =   0.000000;  // 1x1 Kalman uncertainty covariance
  K  =   0.000021;  // 1x1 Kalman gain
  S  =   0.250634;  // 1x1 system uncertainty
echo:  Ps, 0

modeling=15
S:BS::Battery:
  temp_c= 25.000; dg C
 *rp_delt_q=       0.0;  C
 *rp_t_last=      25.0; dg C
  dvoc_dt=  0.004000; V/dg C
  r_0=  0.003000;  ohm
  r_ct =   0.001600;  ohm
  tau_ct=  0.200000;  s (=1/Rct/Cct)
  r_diff=  0.007700;  ohm
  tau_diff = 83.000000;  s (=1/Rdif/Cdif)
  r_sd =  70.000000;  ohm
  tau_sd=25000000.0;  s
  bms_off=0;
  dv_dsoc=122.999954; V/frac
  ib=  0.000; A
  Ib=  0.000; Bank, A
  vb= 14.450; V
  Vb= 14.450; Bank, V
  voc= 14.450; V
  voc_stat= 14.450; V
  vsat= 13.800; V
  dv_dyn=   0.000; V
  sr=  1.000; sclr
  dt=  0.100; s
 *rp_nP= 1.00; P bank, e.g. '2P1S'
 *rp_nS= 1.00; S bank, e.g. '2P1S'
 BS::BS:
  sat_ib_max=  0.000; A
  sat_ib_null=  0.000; A
  sat_cutback_gain= 1000.0; voc>vsat
  model_cutback=1;
  model_saturated=1;
  ib=  0.000; A
  ib_in=  0.000; Saved, A
  ib_fut=  0.000; A
  ib_sat=  0.500;
 *rp_s_cap_model=  1.000; Slr
S::Coulombs:
 q_cap_rated= 390240.0; At t_rated, C
 q_cap_rated_scaled= 390240.0; Act at t_rated_, C
 q_capacity= 390240.0; Sat q at temp, C
 q= 390240.0; Avail, except q_min_, C
 q_min=   9756.0; Low volt shutdown, C
 delta_q      0.0; Change since sat, C
 soc=  1.0000; Frac of q_cap avail (0-1);
 sat=1; T=saturated
 t_rated= 25.0; Rated, dg C
 t_last= 25.0; past, dg C
 t_rlim=  0.017; Tb RL, deg C / s
 resetting=0; Coord user testing of CC
 soc_min=  0.0250; soc BMS shuts off
 mod=Battleborn; Chem e.g. Battleborn or LION
 mod_code=0; Chem code
 coul_eff=  0.99850; Coul Eff
Coulombs::Chemistry:
  dqdt=  0.010; frac/dg C
  low_voc=  9.000; BMS turn off, V
  hys_cap=360000.000; F
  v_sat= 13.850; V
  dvoc_dt=  0.004; V/dg C
  dvoc= -0.050; Cal err, V
  Randles:   r_0= 0.003000; R0, ohm
   r_ct= 0.001600; Chg trans, ohm
   r_diff= 0.007700; Diffusion, ohm
   tau_ct=  0.200; ct, s (=1/Rct/Cct)
   tau_diff= 83.000; diff, s (=1/Rdiff/Cdiff)
  tau_sd=25000000.000; EKF. Parasitic disch, s
  r_sd= 70.000; EKF. Parasitic disch, ohm
  r_ss=  0.012; SS init, ohm
  voc(t, soc):
    y={  5.000,  11.100,  20.000,  30.000,  40.000, };
    x={ -0.150,   0.000,   0.050,   0.100,   0.140,   0.170,   0.200,   0.250,   0.300,   0.400,   0.500,   0.600,   0.700,   0.800,   0.900,   0.990,   0.995,   1.000, };
    v={
      {  4.000,   4.000,   4.000,   4.000,  10.200,  11.700,  12.450,  12.700,  12.770,  12.900,  12.910,  12.980,  13.050,  13.110,  13.170,  13.220,  13.590,  14.450, },
      {  4.000,   4.000,   4.000,   9.500,  12.000,  12.500,  12.700,  12.800,  12.900,  12.960,  13.010,  13.060,  13.110,  13.170,  13.200,  13.230,  13.600,  14.460, },
      {  4.000,   4.000,  10.000,  12.600,  12.770,  12.850,  12.890,  12.950,  12.990,  13.030,  13.040,  13.090,  13.140,  13.210,  13.250,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,  12.000,  12.650,  12.750,  12.800,  12.850,  12.950,  13.000,  13.080,  13.120,  13.160,  13.200,  13.240,  13.260,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,   4.000,   4.000,  10.500,  11.930,  12.780,  12.830,  12.890,  12.970,  13.060,  13.100,  13.130,  13.160,  13.190,  13.200,  13.720,  14.500, },
      };
  soc_min(temp_c):
    x={  5.000,  11.100,  20.000,  30.000,  40.000, };
    v={  0.100,   0.070,   0.050,   0.000,   0.200, };
S::StateSpace:
  dt =  0.100000
   A  =  [ -5.000000,  0.000000,
           0.000000, -0.012048];
   x  =  [  0.000000,  0.000000];
   B  =  [  0.008000,  0.000000,
           0.000093,  0.000000];
   u  =  [  0.000000, 14.450000];
   C  =  [  1.000000,  1.000000];
   D  =  [  0.003000,  1.000000];
   x_dot  =  [  0.000000,  0.000000];
   y  =  [ 14.450000];
   AinvB =  [  0.001600,  0.000000,
           0.007700,  0.000000];
  ::Hysteresis:
  res=0.0150; Null, Ohm
  cap=  360000.0; F
  tau=    5400.0; Null, s
  ib=  0.000; In, A
  ioc=  0.000; Out, A
  soc=  1.0000; Input
  res=  0.015; Var, ohm
  dv_dot=  0.000; V/s
  dv_hys=  0.000; Delta state, V
  disabled=0; input < 1e-5
 *rp_hys_scale=  0.30; Slr
  r(soc, dv):
    y={  0.000,   0.500,   1.000, };
    x={ -0.900,  -0.700,  -0.500,  -0.300,   0.000,   0.300,   0.500,   0.700,   0.900, };
    v={
      {  0.000,   0.064,   0.050,   0.036,   0.015,   0.024,   0.030,   0.046,   0.000, },
      {  0.000,   0.000,   0.050,   0.036,   0.015,   0.024,   0.030,   0.000,   0.000, },
      {  0.000,   0.000,   0.000,   0.036,   0.015,   0.024,   0.000,   0.000,   0.000, },
      };
echo:  Pr, 0

retained parameters (rp):
  debug=0;*v<>
  delta_q=  0.000;*Ca<>
  t_last= 25.000; deg C
  delta_q_model=       0.0;*Ca<>,*Cm<>
  t_last_model= 25.000; deg C
  shunt_gain_sclr=   1.000; A
  ib_scale_amp=   0.892;*SA<> A
  ib_bias_amp=  -0.240;*DA<> A
  ib_scale_noa=   0.940;*SB<> A
  ib_bias_noa= -1.100;*DB<> A
  ib_bias_all=  0.000;*Di<> A 
  ib_select=0;*s<> -1=noa, 0=auto, 1=amp
  vb_bias=  1.500;*Dv,*Dc<> V
  modeling=15;*Xm<>
  amp=  0.000;*Xa<> A pk
  freq=  0.000;*Xf<> r/s
  type=1;*Xt<> 0=sin, 1=sq, 2=tri
  inj_bias=  0.000; A
  tb_bias_hdwe=  0.000;*Dt<> deg C
  s_cap_model=  1.000;*Sc<>
  cutback_gain_scalar=  1.000;*Sk<>
  isum=62;
  delta_q_cinf_amp=  -390240.0; C
  delta_q_dinf_amp=   390240.0; C
  delta_q_cinf_noa= -390240.0; C
  delta_q_dinf_noa=  390240.0; C
  hys_scale=  0.300;*Sh
  tweak_sclr_amp=  1.000;*Mk<>
  tweak_sclr_noa=  1.000;*Nk<>
  nP= 1.00;*BP<> e.g. '2P1S'
  nS= 1.00;*BS<> e.g. '2P1S'
  mon_mod=0;*Bm<> 0=Battle, 1=LION
  sim_mod=0;*Bs<> 0=Battle, 1=LION

command parameters(cp):
 enable_wifi=0; w
 model_cutback=1;
 model_saturated=1;
 soft_reset=0;
 write_summary=0;
 ib_tot_bias_amp=  0.000;
 ib_tot_bias_noa=  0.000;
 dc_dc_on=0;
 blynking=0; z
 publishS=0;
 tb_bias_mode=  0.000;
 s_t_sat=  1.000;
echo:  PM, 0

Tweak::Shunt(Amp)::
 port=0x49;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.892; A
 v2a_s=-272.05; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(Amp)::Tweak(Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.015131; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(Amp)::Adafruit_ADS1x15 (Amp):
 m_bitShift =      4;
 m_gain =       2048;
 s_gain =       1024;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (Amp):
  _addr =        0x49;
  _begun =          1;
  _maxBufferSize = 32;
Shunt(Amp)::
 port=0x49;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.892; A
 v2a_s=-272.05; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(Amp)::Tweak(Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.015133; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(Amp)::Adafruit_ADS1x15 (Amp):
 m_bitShift =      4;
 m_gain =       2048;
 s_gain =       1024;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (Amp):
  _addr =        0x49;
  _begun =          1;
  _maxBufferSize = 32;
echo:  PN, 0

Tweak::Shunt(No Amp)::
 port=0x48;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.940; A
 v2a_s=-1376.99; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(No Amp)::Tweak(No Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.015159; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(No Amp)::Adafruit_ADS1x15 (No Amp):
 m_bitShift =      4;
 m_gain =       2560;
 s_gain =       2560;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (No Amp):
  _addr =        0x48;
  _begun =          1;
  _maxBufferSize = 32;
Shunt(No Amp)::
 port=0x48;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.940; A
 v2a_s=-1376.99; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(No Amp)::Tweak(No Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.015160; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(No Amp)::Adafruit_ADS1x15 (No Amp):
 m_bitShift =      4;
 m_gain =       2560;
 s_gain =       2560;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (No Amp):
  _addr =        0x48;
  _begun =          1;
  _maxBufferSize = 32;
echo:  Pf, 0

Sen::Fault:
 cc_diff   -0.000  thr=  0.200 Fc^
 ib_diff    0.000  thr= 10.000 Fd^
 e_wrap     0.000  thr=-246.000 Fo^393.600 Fi^
 ib_quiet   0.000  thr=  0.005 Fq v

 soc    1.000  voc  14.450  voc_soc  14.450
 dis_tb_fa 0  dis_vb_fa 0  dis_ib_fa 0
 bms_off   0

 Tbh=  0.000  Tbm= 25.000
 Vbh  13.186  Vbm  14.450
 imh   0.000  imm   0.000
 inh   0.000  inm   0.000

 mod_tb  1  mod_vb  1  mod_ib  1
 tb_s_st 1  vb_s_st 1  ib_s_st 1

 bare n  0  x 
 bare m  0  x 
 ib_dsc  0  0 'Fq v'
 ibd_lo  0  0 'Fd ^  *SA/*SB'
 ibd_hi  0  0 'Fd ^  *SA/*SB'
 loss wv 0  0   'Fd, Fi/Fo ^'
 wl      0  0 'Fo ^'
 wh      0  0 'Fi ^'
 cc_dif  x  0 'Fc ^'
 ib n    0  0 'Fi 1'
 ib m    0  0 'Fi 1'
 vb      0  0 'Fv 1  *Dc/*Dv'
 tb      0  0 'Ft 1'
  0000000000000   00000000000
  CBA98765x3210 xxA9876543210
  fltw=0     falw=0
echo:  Xs0.1, 0
s_t_sat     1.0 s to 
    0.1
echo:  Xf0.02, 0
Injected freq set   0.020 Hz =   0.126 r/s
echo:  XW5, 0
Wait     5.0 s to inj
echo:  XT5, 0
Wait     5.0 s tail after
echo:  Xa-2000, 0
Inj amp set -2000.000 & inj_bias set   0.000
echo:  XC20, 0
#inj cycles to  20.000
echo:  v0, 0
echo:  W2, 0
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  XR, 0
RUN: at 66945,  20.000 cycles 71945 to 1071945 with 5000 wait and 5000 tail
          Tweak(Amp)::ignore:, cinf= -390240.0, dinf=  385994.9, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(No Amp)::ignore:, cinf= -390240.0, dinf=  385994.9, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(Amp)::adjust:, cinf=   31782.8, dinf=  -31695.5, delta_soc= -0.081, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(No Amp)::adjust:, cinf=   31782.8, dinf=  -31695.5, delta_soc= -0.081, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(Amp)::adjust:, cinf=   31782.8, dinf=  -31830.6, delta_soc= -0.082, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(No Amp)::adjust:, cinf=   31782.8, dinf=  -31830.6, delta_soc= -0.082, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(Amp)::adjust:, cinf=   31783.4, dinf=  -31640.2, delta_soc= -0.081, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(No Amp)::adjust:, cinf=   31783.4, dinf=  -31640.2, delta_soc= -0.081, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(Amp)::adjust:, cinf=   31783.4, dinf=  -31831.2, delta_soc= -0.082, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(No Amp)::adjust:, cinf=   31783.4, dinf=  -31831.2, delta_soc= -0.082, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
Hi!
Init DISPLAY
DISP allocated
Init CLOUD...done CLOUD
          local    memory
bias amp  -0.940    -0.240
bias noa  -0.170    -1.100
sclr amp   0.984     0.892
sclr noa   1.033     0.940
mon chem 0   0
sim chem 0   0
Do you wish to reset to local? [Y/n]: N
moving on....
End setup()
SHUNT MON Amp init
SHUNT MON No Amp init
echo:  XS, 4
echo:  XS, 0
STOP
echo:  Ca1, 4
echo:  Ca1, 0
soc=  1.000, modeling = 15, delta_q=  0.000, soc_model=  1.0000,   delta_q_model=  0.000, soc_ekf=  0.2885, delta_q_ekf=-277641.420,
soft reset...
echo:  W3, 0
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  Pf, 4
echo:  Pf, 0

Sen::Fault:
 cc_diff   -0.009  thr=  0.200 Fc^
 ib_diff    0.000  thr= 10.000 Fd^
 e_wrap    -0.048  thr=-246.000 Fo^393.600 Fi^
 ib_quiet   0.000  thr=  0.005 Fq v

 soc    1.000  voc  14.450  voc_soc  14.450
 dis_tb_fa 0  dis_vb_fa 0  dis_ib_fa 0
 bms_off   0

 Tbh=  0.000  Tbm= 25.000
 Vbh  13.195  Vbm  14.450
 imh   0.000  imm   0.000
 inh   0.000  inm   0.000

 mod_tb  1  mod_vb  1  mod_ib  1
 tb_s_st 1  vb_s_st 1  ib_s_st 1

 bare n  0  x 
 bare m  0  x 
 ib_dsc  0  0 'Fq v'
 ibd_lo  0  0 'Fd ^  *SA/*SB'
 ibd_hi  0  0 'Fd ^  *SA/*SB'
 loss wv 0  0   'Fd, Fi/Fo ^'
 wl      0  0 'Fo ^'
 wh      0  0 'Fi ^'
 cc_dif  x  0 'Fc ^'
 ib n    0  0 'Fi 1'
 ib m    0  0 'Fi 1'
 vb      0  0 'Fv 1  *Dc/*Dv'
 tb      0  0 'Ft 1'
  0000000000000   00000000000
  CBA98765x3210 xxA9876543210
  fltw=0     falw=0
echo:  Xp9, 4
echo:  Xp9, 0
echo:  Dm1, 0
ShuntAmp.add    0.000 to   1.000
echo:  Dn1, 0
ShuntNoAmp.add   0.000 to   1.000
echo:  Xp0, 0
echo:  Xf0., 0
Injected freq set   0.000 Hz =   0.000 r/s
echo:  Xa0.XS, 0
Inj amp set   0.000 & inj_bias set   0.000
echo:  Mk1, 0
amp tweak_sclr   1.000 to   1.000
echo:  Nk1, 0
Noa tweak_sclr   1.000 to   1.000
echo:  Dn0.998500Xs1.0, 0
ShuntNoAmp.add   1.000 to   0.998
echo:  Di0, 0
rp.ib_bias_all   0.000 to   0.000
echo:  Dm0, 0
ShuntAmp.add    1.000 to   0.000
echo:  Dn0, 0
ShuntNoAmp.add   0.998 to   0.000
echo:  Dv0, 0
Sen->vb_add   0.000 to   0.000
echo:  DT0, 0
Sen.Tb_noise_amp_   0.000 to   0.000
echo:  DV0.0, 0
Sen.Vb_noise_amp_   0.000 to   0.000
echo:  DI0, 0
I ? 'h'
echo:  Xu0, 0
Fail tb 0 to 0
echo:  Xv1., 0
Stale tb time sclr    1.0000 to    1.0000
echo:  Dr100, 0
ReadSensors 100 to 100
echo:  DP4, 0
Print interval 4 to 4
echo:  v0, 0
echo:  Bm0, 0
Mon chem 0 to 0
soft reset...
echo:  Bs0, 0
Sim chem 0 to 0
soft reset...
echo:  Xm15, 0
modeling 15 to 15
Modeling 15
tweak_test 1
mod_ib 1
mod_vb 1
mod_tb 1
echo:  Xts, 0
Set sin.  rp.type = 1
echo:  Ca1, 0
soc=  1.000, modeling = 15, delta_q=  0.000, soc_model=  1.0000,   delta_q_model=  0.000, soc_ekf=  1.0000, delta_q_ekf= -0.394,
soft reset...
echo:  W3, 0
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  Ri, 0
Amp chg CC -384053.9 to -390240.0
Amp dchg CC  390240.0 to  390240.0
Noa chg CC -384053.9 to -390240.0
Noa dchg CC  390240.0 to  390240.0
echo:  Mw0, 0
Amp->time_to_wait   6.000 to   0.000
echo:  Nw0, 0
Noa->time_to_wait   6.000 to   0.000
echo:  MC0.004, 0
Amp->max_change_   0.001000 to   0.004000
echo:  Mx0.04, 0
Amp->max_tweak   0.010 to   0.040
echo:  NC0.004, 0
Noa->max_change_   0.001000 to   0.004000
echo:  Nx0.04, 0
Noa->max_tweak   0.010 to   0.040
echo:  Mk1, 0
amp tweak_sclr   1.000 to   1.000
echo:  Nk1, 0
Noa tweak_sclr   1.000 to   1.000
echo:  DP2, 0
Print interval 4 to 2
echo:  Rb, 0
echo:  Pa, 0
echo:  Pm, 0
BM::Battery:
  temp_c= 25.000; dg C
 *rp_delt_q=       0.0;  C
 *rp_t_last=      25.0; dg C
  dvoc_dt=  0.004000; V/dg C
  r_0=  0.003000;  ohm
  r_ct =   0.001600;  ohm
  tau_ct=  0.200000;  s (=1/Rct/Cct)
  r_diff=  0.007700;  ohm
  tau_diff = 83.000000;  s (=1/Rdif/Cdif)
  r_sd =  70.000000;  ohm
  tau_sd=25000000.0;  s
  bms_off=0;
  dv_dsoc=122.984123; V/frac
  ib=  0.000; A
  Ib=  0.000; Bank, A
  vb= 14.450; V
  Vb= 14.450; Bank, V
  voc= 14.450; V
  voc_stat= 14.450; V
  vsat= 13.800; V
  dv_dyn=   0.000; V
  sr=  1.000; sclr
  dt=  0.100; s
 *rp_nP= 1.00; P bank, e.g. '2P1S'
 *rp_nS= 1.00; S bank, e.g. '2P1S'
 BM::BM:
  ah_rem_ekf_=105.690; A-h
  ah_rem_soc_=105.690; A-h
  EKF_conv=0;
  q_ekf=  390239.6; C
  soc_ekf=  1.0000; frac
  tcharge= 24.0; hr
  tcharge_ekf=  0.0; hr
  voc_filt= 14.400; V
  voc_stat= 14.450; V
  y_filt=  0.490; Res EKF, V
Coulombs:
 q_cap_rated= 390240.0; At t_rated, C
 q_cap_rated_scaled= 390240.0; Act at t_rated_, C
 q_capacity= 390240.0; Sat q at temp, C
 q= 390240.0; Avail, except q_min_, C
 q_min=   9756.0; Low volt shutdown, C
 delta_q      0.0; Change since sat, C
 soc=  1.0000; Frac of q_cap avail (0-1);
 sat=1; T=saturated
 t_rated= 25.0; Rated, dg C
 t_last= 25.0; past, dg C
 t_rlim=  0.017; Tb RL, deg C / s
 resetting=0; Coord user testing of CC
 soc_min=  0.0250; soc BMS shuts off
 mod=Battleborn; Chem e.g. Battleborn or LION
 mod_code=0; Chem code
 coul_eff=  0.99850; Coul Eff
Coulombs::Chemistry:
  dqdt=  0.010; frac/dg C
  low_voc=  9.000; BMS turn off, V
  hys_cap=360000.000; F
  v_sat= 13.850; V
  dvoc_dt=  0.004; V/dg C
  dvoc= -0.050; Cal err, V
  Randles:   r_0= 0.003000; R0, ohm
   r_ct= 0.001600; Chg trans, ohm
   r_diff= 0.007700; Diffusion, ohm
   tau_ct=  0.200; ct, s (=1/Rct/Cct)
   tau_diff= 83.000; diff, s (=1/Rdiff/Cdiff)
  tau_sd=25000000.000; EKF. Parasitic disch, s
  r_sd= 70.000; EKF. Parasitic disch, ohm
  r_ss=  0.012; SS init, ohm
  voc(t, soc):
    y={  5.000,  11.100,  20.000,  30.000,  40.000, };
    x={ -0.150,   0.000,   0.050,   0.100,   0.140,   0.170,   0.200,   0.250,   0.300,   0.400,   0.500,   0.600,   0.700,   0.800,   0.900,   0.990,   0.995,   1.000, };
    v={
      {  4.000,   4.000,   4.000,   4.000,  10.200,  11.700,  12.450,  12.700,  12.770,  12.900,  12.910,  12.980,  13.050,  13.110,  13.170,  13.220,  13.590,  14.450, },
      {  4.000,   4.000,   4.000,   9.500,  12.000,  12.500,  12.700,  12.800,  12.900,  12.960,  13.010,  13.060,  13.110,  13.170,  13.200,  13.230,  13.600,  14.460, },
      {  4.000,   4.000,  10.000,  12.600,  12.770,  12.850,  12.890,  12.950,  12.990,  13.030,  13.040,  13.090,  13.140,  13.210,  13.250,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,  12.000,  12.650,  12.750,  12.800,  12.850,  12.950,  13.000,  13.080,  13.120,  13.160,  13.200,  13.240,  13.260,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,   4.000,   4.000,  10.500,  11.930,  12.780,  12.830,  12.890,  12.970,  13.060,  13.100,  13.130,  13.160,  13.190,  13.200,  13.720,  14.500, },
      };
  soc_min(temp_c):
    x={  5.000,  11.100,  20.000,  30.000,  40.000, };
    v={  0.100,   0.070,   0.050,   0.000,   0.200, };
StateSpace:
  dt =  0.100000
   A  =  [ -5.000000,  0.000000,
           0.000000, -0.012048];
   x  =  [  0.000000,  0.000000];
   B  =  [  0.008000,  0.000000,
           0.000093,  0.000000];
   u  =  [  0.000000, 14.450000];
   C  =  [ -1.000000, -1.000000];
   D  =  [ -0.003000,  1.000000];
   x_dot  =  [  0.000000,  0.000000];
   y  =  [ 14.450000];
   AinvB =  [  0.001600,  0.000000,
           0.007700,  0.000000];
  ::Hysteresis:
  res=0.0150; Null, Ohm
  cap=  360000.0; F
  tau=    5400.0; Null, s
  ib=  0.000; In, A
  ioc=  0.000; Out, A
  soc=  1.0000; Input
  res=  0.015; Var, ohm
  dv_dot=  0.000; V/s
  dv_hys=  0.000; Delta state, V
  disabled=0; input < 1e-5
 *rp_hys_scale=  0.30; Slr
  r(soc, dv):
    y={  0.000,   0.500,   1.000, };
    x={ -0.900,  -0.700,  -0.500,  -0.300,   0.000,   0.300,   0.500,   0.700,   0.900, };
    v={
      {  0.000,   0.064,   0.050,   0.036,   0.015,   0.024,   0.030,   0.046,   0.000, },
      {  0.000,   0.000,   0.050,   0.036,   0.015,   0.024,   0.030,   0.000,   0.000, },
      {  0.000,   0.000,   0.000,   0.036,   0.015,   0.024,   0.000,   0.000,   0.000, },
      };
EKF_1x1:
Inputs:
  z  =    14.4500;  // 1x1 input, =voc, dynamic predicted by other model, V
  R  =   0.250000;  // 1x1 Kalman state uncertainty
  Q  =   0.000000;  // 1x1 Kalman process uncertainty
  H  =    122.984;  // 1x1 Jacobian sensitivity dV/dSOC
Outputs:
  x  =     1.0000;  // 1x1 Kalman state variable = Vsoc (0-1 fraction)
  hx =    14.4498;  // Output of observation function h(x)
  y  =     0.0002;  // 1x1 Residual z-hx, V
  P  =   0.000000;  // 1x1 Kalman uncertainty covariance
  K  =   0.000021;  // 1x1 Kalman gain
  S  =   0.250634;  // 1x1 system uncertainty
echo:  Ps, 0

modeling=15
S:BS::Battery:
  temp_c= 25.000; dg C
 *rp_delt_q=       0.0;  C
 *rp_t_last=      25.0; dg C
  dvoc_dt=  0.004000; V/dg C
  r_0=  0.003000;  ohm
  r_ct =   0.001600;  ohm
  tau_ct=  0.200000;  s (=1/Rct/Cct)
  r_diff=  0.007700;  ohm
  tau_diff = 83.000000;  s (=1/Rdif/Cdif)
  r_sd =  70.000000;  ohm
  tau_sd=25000000.0;  s
  bms_off=0;
  dv_dsoc=122.999954; V/frac
  ib=  0.000; A
  Ib=  0.000; Bank, A
  vb= 14.450; V
  Vb= 14.450; Bank, V
  voc= 14.450; V
  voc_stat= 14.450; V
  vsat= 13.800; V
  dv_dyn=   0.000; V
  sr=  1.000; sclr
  dt=  0.100; s
 *rp_nP= 1.00; P bank, e.g. '2P1S'
 *rp_nS= 1.00; S bank, e.g. '2P1S'
 BS::BS:
  sat_ib_max=  0.000; A
  sat_ib_null=  0.000; A
  sat_cutback_gain= 1000.0; voc>vsat
  model_cutback=1;
  model_saturated=1;
  ib=  0.000; A
  ib_in=  0.000; Saved, A
  ib_fut=  0.000; A
  ib_sat=  0.500;
 *rp_s_cap_model=  1.000; Slr
S::Coulombs:
 q_cap_rated= 390240.0; At t_rated, C
 q_cap_rated_scaled= 390240.0; Act at t_rated_, C
 q_capacity= 390240.0; Sat q at temp, C
 q= 390240.0; Avail, except q_min_, C
 q_min=   9756.0; Low volt shutdown, C
 delta_q      0.0; Change since sat, C
 soc=  1.0000; Frac of q_cap avail (0-1);
 sat=1; T=saturated
 t_rated= 25.0; Rated, dg C
 t_last= 25.0; past, dg C
 t_rlim=  0.017; Tb RL, deg C / s
 resetting=0; Coord user testing of CC
 soc_min=  0.0250; soc BMS shuts off
 mod=Battleborn; Chem e.g. Battleborn or LION
 mod_code=0; Chem code
 coul_eff=  0.99850; Coul Eff
Coulombs::Chemistry:
  dqdt=  0.010; frac/dg C
  low_voc=  9.000; BMS turn off, V
  hys_cap=360000.000; F
  v_sat= 13.850; V
  dvoc_dt=  0.004; V/dg C
  dvoc= -0.050; Cal err, V
  Randles:   r_0= 0.003000; R0, ohm
   r_ct= 0.001600; Chg trans, ohm
   r_diff= 0.007700; Diffusion, ohm
   tau_ct=  0.200; ct, s (=1/Rct/Cct)
   tau_diff= 83.000; diff, s (=1/Rdiff/Cdiff)
  tau_sd=25000000.000; EKF. Parasitic disch, s
  r_sd= 70.000; EKF. Parasitic disch, ohm
  r_ss=  0.012; SS init, ohm
  voc(t, soc):
    y={  5.000,  11.100,  20.000,  30.000,  40.000, };
    x={ -0.150,   0.000,   0.050,   0.100,   0.140,   0.170,   0.200,   0.250,   0.300,   0.400,   0.500,   0.600,   0.700,   0.800,   0.900,   0.990,   0.995,   1.000, };
    v={
      {  4.000,   4.000,   4.000,   4.000,  10.200,  11.700,  12.450,  12.700,  12.770,  12.900,  12.910,  12.980,  13.050,  13.110,  13.170,  13.220,  13.590,  14.450, },
      {  4.000,   4.000,   4.000,   9.500,  12.000,  12.500,  12.700,  12.800,  12.900,  12.960,  13.010,  13.060,  13.110,  13.170,  13.200,  13.230,  13.600,  14.460, },
      {  4.000,   4.000,  10.000,  12.600,  12.770,  12.850,  12.890,  12.950,  12.990,  13.030,  13.040,  13.090,  13.140,  13.210,  13.250,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,  12.000,  12.650,  12.750,  12.800,  12.850,  12.950,  13.000,  13.080,  13.120,  13.160,  13.200,  13.240,  13.260,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,   4.000,   4.000,  10.500,  11.930,  12.780,  12.830,  12.890,  12.970,  13.060,  13.100,  13.130,  13.160,  13.190,  13.200,  13.720,  14.500, },
      };
  soc_min(temp_c):
    x={  5.000,  11.100,  20.000,  30.000,  40.000, };
    v={  0.100,   0.070,   0.050,   0.000,   0.200, };
S::StateSpace:
  dt =  0.100000
   A  =  [ -5.000000,  0.000000,
           0.000000, -0.012048];
   x  =  [  0.000000,  0.000000];
   B  =  [  0.008000,  0.000000,
           0.000093,  0.000000];
   u  =  [  0.000000, 14.450000];
   C  =  [  1.000000,  1.000000];
   D  =  [  0.003000,  1.000000];
   x_dot  =  [  0.000000,  0.000000];
   y  =  [ 14.450000];
   AinvB =  [  0.001600,  0.000000,
           0.007700,  0.000000];
  ::Hysteresis:
  res=0.0150; Null, Ohm
  cap=  360000.0; F
  tau=    5400.0; Null, s
  ib=  0.000; In, A
  ioc=  0.000; Out, A
  soc=  1.0000; Input
  res=  0.015; Var, ohm
  dv_dot=  0.000; V/s
  dv_hys=  0.000; Delta state, V
  disabled=0; input < 1e-5
 *rp_hys_scale=  0.30; Slr
  r(soc, dv):
    y={  0.000,   0.500,   1.000, };
    x={ -0.900,  -0.700,  -0.500,  -0.300,   0.000,   0.300,   0.500,   0.700,   0.900, };
    v={
      {  0.000,   0.064,   0.050,   0.036,   0.015,   0.024,   0.030,   0.046,   0.000, },
      {  0.000,   0.000,   0.050,   0.036,   0.015,   0.024,   0.030,   0.000,   0.000, },
      {  0.000,   0.000,   0.000,   0.036,   0.015,   0.024,   0.000,   0.000,   0.000, },
      };
echo:  Pr, 0

retained parameters (rp):
  debug=0;*v<>
  delta_q=  0.000;*Ca<>
  t_last= 25.000; deg C
  delta_q_model=       0.0;*Ca<>,*Cm<>
  t_last_model= 25.000; deg C
  shunt_gain_sclr=   1.000; A
  ib_scale_amp=   0.892;*SA<> A
  ib_bias_amp=  -0.240;*DA<> A
  ib_scale_noa=   0.940;*SB<> A
  ib_bias_noa= -1.100;*DB<> A
  ib_bias_all=  0.000;*Di<> A 
  ib_select=0;*s<> -1=noa, 0=auto, 1=amp
  vb_bias=  1.500;*Dv,*Dc<> V
  modeling=15;*Xm<>
  amp=  0.000;*Xa<> A pk
  freq=  0.000;*Xf<> r/s
  type=1;*Xt<> 0=sin, 1=sq, 2=tri
  inj_bias=  0.000; A
  tb_bias_hdwe=  0.000;*Dt<> deg C
  s_cap_model=  1.000;*Sc<>
  cutback_gain_scalar=  1.000;*Sk<>
  isum=62;
  delta_q_cinf_amp=  -390240.0; C
  delta_q_dinf_amp=   390240.0; C
  delta_q_cinf_noa= -390240.0; C
  delta_q_dinf_noa=  390240.0; C
  hys_scale=  0.300;*Sh
  tweak_sclr_amp=  1.000;*Mk<>
  tweak_sclr_noa=  1.000;*Nk<>
  nP= 1.00;*BP<> e.g. '2P1S'
  nS= 1.00;*BS<> e.g. '2P1S'
  mon_mod=0;*Bm<> 0=Battle, 1=LION
  sim_mod=0;*Bs<> 0=Battle, 1=LION

command parameters(cp):
 enable_wifi=0; w
 model_cutback=1;
 model_saturated=1;
 soft_reset=0;
 write_summary=0;
 ib_tot_bias_amp=  0.000;
 ib_tot_bias_noa=  0.000;
 dc_dc_on=0;
 blynking=0; z
 publishS=1;
 tb_bias_mode=  0.000;
 s_t_sat=  1.000;
echo:  PM, 0

Tweak::Shunt(Amp)::
 port=0x49;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.892; A
 v2a_s=-272.05; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(Amp)::Tweak(Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.006075; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(Amp)::Adafruit_ADS1x15 (Amp):
 m_bitShift =      4;
 m_gain =       2048;
 s_gain =       1024;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (Amp):
  _addr =        0x49;
  _begun =          1;
  _maxBufferSize = 32;
Shunt(Amp)::
 port=0x49;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.892; A
 v2a_s=-272.05; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(Amp)::Tweak(Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.006077; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(Amp)::Adafruit_ADS1x15 (Amp):
 m_bitShift =      4;
 m_gain =       2048;
 s_gain =       1024;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (Amp):
  _addr =        0x49;
  _begun =          1;
  _maxBufferSize = 32;
echo:  PN, 0

Tweak::Shunt(No Amp)::
 port=0x48;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.940; A
 v2a_s=-1376.99; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(No Amp)::Tweak(No Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.006103; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(No Amp)::Adafruit_ADS1x15 (No Amp):
 m_bitShift =      4;
 m_gain =       2560;
 s_gain =       2560;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (No Amp):
  _addr =        0x48;
  _begun =          1;
  _maxBufferSize = 32;
Shunt(No Amp)::
 port=0x48;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.940; A
 v2a_s=-1376.99; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(No Amp)::Tweak(No Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.006104; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(No Amp)::Adafruit_ADS1x15 (No Amp):
 m_bitShift =      4;
 m_gain =       2560;
 s_gain =       2560;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (No Amp):
  _addr =        0x48;
  _begun =          1;
  _maxBufferSize = 32;
echo:  Pf, 0

Sen::Fault:
 cc_diff   -0.000  thr=  0.200 Fc^
 ib_diff    0.000  thr= 10.000 Fd^
 e_wrap     0.000  thr=-246.000 Fo^393.600 Fi^
 ib_quiet   0.000  thr=  0.005 Fq v

 soc    1.000  voc  14.450  voc_soc  14.450
 dis_tb_fa 0  dis_vb_fa 0  dis_ib_fa 0
 bms_off   0

 Tbh=  0.000  Tbm= 25.000
 Vbh  13.191  Vbm  14.450
 imh   0.000  imm   0.000
 inh   0.000  inm   0.000

 mod_tb  1  mod_vb  1  mod_ib  1
 tb_s_st 1  vb_s_st 1  ib_s_st 1

 bare n  0  x 
 bare m  0  x 
 ib_dsc  0  0 'Fq v'
 ibd_lo  0  0 'Fd ^  *SA/*SB'
 ibd_hi  0  0 'Fd ^  *SA/*SB'
 loss wv 0  0   'Fd, Fi/Fo ^'
 wl      0  0 'Fo ^'
 wh      0  0 'Fi ^'
 cc_dif  x  0 'Fc ^'
 ib n    0  0 'Fi 1'
 ib m    0  0 'Fi 1'
 vb      0  0 'Fv 1  *Dc/*Dv'
 tb      0  0 'Ft 1'
  0000000000000   00000000000
  CBA98765x3210 xxA9876543210
  fltw=0     falw=0
echo:  Xs0.1, 0
s_t_sat     1.0 s to 
    0.1
echo:  Xf0.02, 0
Injected freq set   0.020 Hz =   0.126 r/s
echo:  XW5, 0
Wait     5.0 s to inj
echo:  XT5, 0
Wait     5.0 s tail after
echo:  Xa-2000, 0
Inj amp set -2000.000 & inj_bias set   0.000
echo:  XC20, 0
#inj cycles to  20.000
echo:  v0, 0
echo:  W2, 0
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  XR, 0
RUN: at 26507,  20.000 cycles 31507 to 1031507 with 5000 wait and 5000 tail
          Tweak(Amp)::ignore:, cinf= -390240.0, dinf=  385994.9, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(No Amp)::ignore:, cinf= -390240.0, dinf=  385994.9, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(Amp)::ignore:, cinf=   31782.8, dinf=  -31695.5, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(No Amp)::ignore:, cinf=   31782.8, dinf=  -31695.5, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(Amp)::ignore:, cinf=   31782.8, dinf=  -31830.6, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(No Amp)::ignore:, cinf=   31782.8, dinf=  -31830.6, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(Amp)::ignore:, cinf=   31782.0, dinf=  -31639.7, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(No Amp)::ignore:, cinf=   31782.0, dinf=  -31639.7, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
echo:  XS, 4
echo:  XS, 0
STOP
Hi!
Init DISPLAY
DISP allocated
Init CLOUD...done CLOUD
          local    memory
bias amp  -0.940    -0.240
bias noa  -0.170    -1.100
sclr amp   0.984     0.892
sclr noa   1.033     0.940
mon chem 0   0
sim chem 0   0
Do you wish to reset to local? [Y/n]: N
moving on....
End setup()
SHUNT MON Amp init
SHUNT MON No Amp init
echo:  Xp9, 4
echo:  Xp9, 0
echo:  Dm1, 0
ShuntAmp.add    0.000 to   1.000
echo:  Dn1, 0
ShuntNoAmp.add   0.000 to   1.000
echo:  Xp0, 0
echo:  Xf0., 0
Injected freq set   0.000 Hz =   0.000 r/s
echo:  Xa0.XS, 0
Inj amp set   0.000 & inj_bias set   0.000
echo:  Mk1, 0
amp tweak_sclr   1.000 to   1.000
echo:  Nk1, 0
Noa tweak_sclr   1.000 to   1.000
echo:  Dn0.998500Xs1.0, 0
ShuntNoAmp.add   1.000 to   0.998
echo:  Di0, 0
rp.ib_bias_all   0.000 to   0.000
echo:  Dm0, 0
ShuntAmp.add    1.000 to   0.000
echo:  Dn0, 0
ShuntNoAmp.add   0.998 to   0.000
echo:  Dv0, 0
Sen->vb_add  -0.000 to   0.000
echo:  DT0, 0
Sen.Tb_noise_amp_   0.000 to   0.000
echo:  DV0.0, 0
Sen.Vb_noise_amp_   0.000 to   0.000
echo:  DI0, 0
I ? 'h'
echo:  Xu0, 0
Fail tb 0 to 0
echo:  Xv1., 0
Stale tb time sclr    1.0000 to    1.0000
echo:  Dr100, 0
ReadSensors 100 to 100
echo:  DP4, 0
Print interval 4 to 4
echo:  v0, 0
echo:  Bm0, 0
Mon chem 0 to 0
soft reset...
echo:  Bs0, 0
Sim chem 0 to 0
soft reset...
echo:  Xm15, 0
modeling 15 to 15
Modeling 15
tweak_test 1
mod_ib 1
mod_vb 1
mod_tb 1
echo:  Xts, 0
Set sin.  rp.type = 1
echo:  Ca1, 0
soc=  1.000, modeling = 15, delta_q=  0.000, soc_model=  1.0000,   delta_q_model=  0.000, soc_ekf=  0.9729, delta_q_ekf=-10583.633,
soft reset...
echo:  W3, 0
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  Ri, 0
Amp chg CC -390239.9 to -390240.0
Amp dchg CC  390240.0 to  390240.0
Noa chg CC -390239.9 to -390240.0
Noa dchg CC  390240.0 to  390240.0
echo:  Mw0, 0
Amp->time_to_wait   6.000 to   0.000
echo:  Nw0, 0
Noa->time_to_wait   6.000 to   0.000
echo:  MC0.004, 0
Amp->max_change_   0.001000 to   0.004000
echo:  Mx0.04, 0
Amp->max_tweak   0.010 to   0.040
echo:  NC0.004, 0
Noa->max_change_   0.001000 to   0.004000
echo:  Nx0.04, 0
Noa->max_tweak   0.010 to   0.040
echo:  Mk1, 0
amp tweak_sclr   1.000 to   1.000
echo:  Nk1, 0
Noa tweak_sclr   1.000 to   1.000
echo:  DP2, 0
Print interval 4 to 2
echo:  Rb, 0
echo:  Pa, 0
echo:  Pm, 0
BM::Battery:
  temp_c= 25.000; dg C
 *rp_delt_q=       0.0;  C
 *rp_t_last=      25.0; dg C
  dvoc_dt=  0.004000; V/dg C
  r_0=  0.003000;  ohm
  r_ct =   0.001600;  ohm
  tau_ct=  0.200000;  s (=1/Rct/Cct)
  r_diff=  0.007700;  ohm
  tau_diff = 83.000000;  s (=1/Rdif/Cdif)
  r_sd =  70.000000;  ohm
  tau_sd=25000000.0;  s
  bms_off=0;
  dv_dsoc=122.984123; V/frac
  ib=  0.000; A
  Ib=  0.000; Bank, A
  vb= 14.450; V
  Vb= 14.450; Bank, V
  voc= 14.450; V
  voc_stat= 14.450; V
  vsat= 13.800; V
  dv_dyn=   0.000; V
  sr=  1.000; sclr
  dt=  0.100; s
 *rp_nP= 1.00; P bank, e.g. '2P1S'
 *rp_nS= 1.00; S bank, e.g. '2P1S'
 BM::BM:
  ah_rem_ekf_=105.690; A-h
  ah_rem_soc_=105.690; A-h
  EKF_conv=1;
  q_ekf=  390239.6; C
  soc_ekf=  1.0000; frac
  tcharge= 24.0; hr
  tcharge_ekf=  0.0; hr
  voc_filt= 14.400; V
  voc_stat= 14.450; V
  y_filt=  0.000; Res EKF, V
Coulombs:
 q_cap_rated= 390240.0; At t_rated, C
 q_cap_rated_scaled= 390240.0; Act at t_rated_, C
 q_capacity= 390240.0; Sat q at temp, C
 q= 390240.0; Avail, except q_min_, C
 q_min=   9756.0; Low volt shutdown, C
 delta_q      0.0; Change since sat, C
 soc=  1.0000; Frac of q_cap avail (0-1);
 sat=1; T=saturated
 t_rated= 25.0; Rated, dg C
 t_last= 25.0; past, dg C
 t_rlim=  0.017; Tb RL, deg C / s
 resetting=0; Coord user testing of CC
 soc_min=  0.0250; soc BMS shuts off
 mod=Battleborn; Chem e.g. Battleborn or LION
 mod_code=0; Chem code
 coul_eff=  0.99850; Coul Eff
Coulombs::Chemistry:
  dqdt=  0.010; frac/dg C
  low_voc=  9.000; BMS turn off, V
  hys_cap=360000.000; F
  v_sat= 13.850; V
  dvoc_dt=  0.004; V/dg C
  dvoc= -0.050; Cal err, V
  Randles:   r_0= 0.003000; R0, ohm
   r_ct= 0.001600; Chg trans, ohm
   r_diff= 0.007700; Diffusion, ohm
   tau_ct=  0.200; ct, s (=1/Rct/Cct)
   tau_diff= 83.000; diff, s (=1/Rdiff/Cdiff)
  tau_sd=25000000.000; EKF. Parasitic disch, s
  r_sd= 70.000; EKF. Parasitic disch, ohm
  r_ss=  0.012; SS init, ohm
  voc(t, soc):
    y={  5.000,  11.100,  20.000,  30.000,  40.000, };
    x={ -0.150,   0.000,   0.050,   0.100,   0.140,   0.170,   0.200,   0.250,   0.300,   0.400,   0.500,   0.600,   0.700,   0.800,   0.900,   0.990,   0.995,   1.000, };
    v={
      {  4.000,   4.000,   4.000,   4.000,  10.200,  11.700,  12.450,  12.700,  12.770,  12.900,  12.910,  12.980,  13.050,  13.110,  13.170,  13.220,  13.590,  14.450, },
      {  4.000,   4.000,   4.000,   9.500,  12.000,  12.500,  12.700,  12.800,  12.900,  12.960,  13.010,  13.060,  13.110,  13.170,  13.200,  13.230,  13.600,  14.460, },
      {  4.000,   4.000,  10.000,  12.600,  12.770,  12.850,  12.890,  12.950,  12.990,  13.030,  13.040,  13.090,  13.140,  13.210,  13.250,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,  12.000,  12.650,  12.750,  12.800,  12.850,  12.950,  13.000,  13.080,  13.120,  13.160,  13.200,  13.240,  13.260,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,   4.000,   4.000,  10.500,  11.930,  12.780,  12.830,  12.890,  12.970,  13.060,  13.100,  13.130,  13.160,  13.190,  13.200,  13.720,  14.500, },
      };
  soc_min(temp_c):
    x={  5.000,  11.100,  20.000,  30.000,  40.000, };
    v={  0.100,   0.070,   0.050,   0.000,   0.200, };
StateSpace:
  dt =  0.100000
   A  =  [ -5.000000,  0.000000,
           0.000000, -0.012048];
   x  =  [  0.000000,  0.000000];
   B  =  [  0.008000,  0.000000,
           0.000093,  0.000000];
   u  =  [  0.000000, 14.450000];
   C  =  [ -1.000000, -1.000000];
   D  =  [ -0.003000,  1.000000];
   x_dot  =  [  0.000000,  0.000000];
   y  =  [ 14.450000];
   AinvB =  [  0.001600,  0.000000,
           0.007700,  0.000000];
  ::Hysteresis:
  res=0.0150; Null, Ohm
  cap=  360000.0; F
  tau=    5400.0; Null, s
  ib=  0.000; In, A
  ioc=  0.000; Out, A
  soc=  1.0000; Input
  res=  0.015; Var, ohm
  dv_dot=  0.000; V/s
  dv_hys=  0.000; Delta state, V
  disabled=0; input < 1e-5
 *rp_hys_scale=  0.30; Slr
  r(soc, dv):
    y={  0.000,   0.500,   1.000, };
    x={ -0.900,  -0.700,  -0.500,  -0.300,   0.000,   0.300,   0.500,   0.700,   0.900, };
    v={
      {  0.000,   0.064,   0.050,   0.036,   0.015,   0.024,   0.030,   0.046,   0.000, },
      {  0.000,   0.000,   0.050,   0.036,   0.015,   0.024,   0.030,   0.000,   0.000, },
      {  0.000,   0.000,   0.000,   0.036,   0.015,   0.024,   0.000,   0.000,   0.000, },
      };
EKF_1x1:
Inputs:
  z  =    14.4500;  // 1x1 input, =voc, dynamic predicted by other model, V
  R  =   0.250000;  // 1x1 Kalman state uncertainty
  Q  =   0.000000;  // 1x1 Kalman process uncertainty
  H  =    122.984;  // 1x1 Jacobian sensitivity dV/dSOC
Outputs:
  x  =     1.0000;  // 1x1 Kalman state variable = Vsoc (0-1 fraction)
  hx =    14.4498;  // Output of observation function h(x)
  y  =     0.0002;  // 1x1 Residual z-hx, V
  P  =   0.000000;  // 1x1 Kalman uncertainty covariance
  K  =   0.000021;  // 1x1 Kalman gain
  S  =   0.250634;  // 1x1 system uncertainty
echo:  Ps, 0

modeling=15
S:BS::Battery:
  temp_c= 25.000; dg C
 *rp_delt_q=       0.0;  C
 *rp_t_last=      25.0; dg C
  dvoc_dt=  0.004000; V/dg C
  r_0=  0.003000;  ohm
  r_ct =   0.001600;  ohm
  tau_ct=  0.200000;  s (=1/Rct/Cct)
  r_diff=  0.007700;  ohm
  tau_diff = 83.000000;  s (=1/Rdif/Cdif)
  r_sd =  70.000000;  ohm
  tau_sd=25000000.0;  s
  bms_off=0;
  dv_dsoc=122.999954; V/frac
  ib=  0.000; A
  Ib=  0.000; Bank, A
  vb= 14.450; V
  Vb= 14.450; Bank, V
  voc= 14.450; V
  voc_stat= 14.450; V
  vsat= 13.800; V
  dv_dyn=   0.000; V
  sr=  1.000; sclr
  dt=  0.100; s
 *rp_nP= 1.00; P bank, e.g. '2P1S'
 *rp_nS= 1.00; S bank, e.g. '2P1S'
 BS::BS:
  sat_ib_max=  0.000; A
  sat_ib_null=  0.000; A
  sat_cutback_gain= 1000.0; voc>vsat
  model_cutback=1;
  model_saturated=1;
  ib=  0.000; A
  ib_in=  0.000; Saved, A
  ib_fut=  0.000; A
  ib_sat=  0.500;
 *rp_s_cap_model=  1.000; Slr
S::Coulombs:
 q_cap_rated= 390240.0; At t_rated, C
 q_cap_rated_scaled= 390240.0; Act at t_rated_, C
 q_capacity= 390240.0; Sat q at temp, C
 q= 390240.0; Avail, except q_min_, C
 q_min=   9756.0; Low volt shutdown, C
 delta_q      0.0; Change since sat, C
 soc=  1.0000; Frac of q_cap avail (0-1);
 sat=1; T=saturated
 t_rated= 25.0; Rated, dg C
 t_last= 25.0; past, dg C
 t_rlim=  0.017; Tb RL, deg C / s
 resetting=0; Coord user testing of CC
 soc_min=  0.0250; soc BMS shuts off
 mod=Battleborn; Chem e.g. Battleborn or LION
 mod_code=0; Chem code
 coul_eff=  0.99850; Coul Eff
Coulombs::Chemistry:
  dqdt=  0.010; frac/dg C
  low_voc=  9.000; BMS turn off, V
  hys_cap=360000.000; F
  v_sat= 13.850; V
  dvoc_dt=  0.004; V/dg C
  dvoc= -0.050; Cal err, V
  Randles:   r_0= 0.003000; R0, ohm
   r_ct= 0.001600; Chg trans, ohm
   r_diff= 0.007700; Diffusion, ohm
   tau_ct=  0.200; ct, s (=1/Rct/Cct)
   tau_diff= 83.000; diff, s (=1/Rdiff/Cdiff)
  tau_sd=25000000.000; EKF. Parasitic disch, s
  r_sd= 70.000; EKF. Parasitic disch, ohm
  r_ss=  0.012; SS init, ohm
  voc(t, soc):
    y={  5.000,  11.100,  20.000,  30.000,  40.000, };
    x={ -0.150,   0.000,   0.050,   0.100,   0.140,   0.170,   0.200,   0.250,   0.300,   0.400,   0.500,   0.600,   0.700,   0.800,   0.900,   0.990,   0.995,   1.000, };
    v={
      {  4.000,   4.000,   4.000,   4.000,  10.200,  11.700,  12.450,  12.700,  12.770,  12.900,  12.910,  12.980,  13.050,  13.110,  13.170,  13.220,  13.590,  14.450, },
      {  4.000,   4.000,   4.000,   9.500,  12.000,  12.500,  12.700,  12.800,  12.900,  12.960,  13.010,  13.060,  13.110,  13.170,  13.200,  13.230,  13.600,  14.460, },
      {  4.000,   4.000,  10.000,  12.600,  12.770,  12.850,  12.890,  12.950,  12.990,  13.030,  13.040,  13.090,  13.140,  13.210,  13.250,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,  12.000,  12.650,  12.750,  12.800,  12.850,  12.950,  13.000,  13.080,  13.120,  13.160,  13.200,  13.240,  13.260,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,   4.000,   4.000,  10.500,  11.930,  12.780,  12.830,  12.890,  12.970,  13.060,  13.100,  13.130,  13.160,  13.190,  13.200,  13.720,  14.500, },
      };
  soc_min(temp_c):
    x={  5.000,  11.100,  20.000,  30.000,  40.000, };
    v={  0.100,   0.070,   0.050,   0.000,   0.200, };
S::StateSpace:
  dt =  0.100000
   A  =  [ -5.000000,  0.000000,
           0.000000, -0.012048];
   x  =  [  0.000000,  0.000000];
   B  =  [  0.008000,  0.000000,
           0.000093,  0.000000];
   u  =  [  0.000000, 14.450000];
   C  =  [  1.000000,  1.000000];
   D  =  [  0.003000,  1.000000];
   x_dot  =  [  0.000000,  0.000000];
   y  =  [ 14.450000];
   AinvB =  [  0.001600,  0.000000,
           0.007700,  0.000000];
  ::Hysteresis:
  res=0.0150; Null, Ohm
  cap=  360000.0; F
  tau=    5400.0; Null, s
  ib=  0.000; In, A
  ioc=  0.000; Out, A
  soc=  1.0000; Input
  res=  0.015; Var, ohm
  dv_dot=  0.000; V/s
  dv_hys=  0.000; Delta state, V
  disabled=0; input < 1e-5
 *rp_hys_scale=  0.30; Slr
  r(soc, dv):
    y={  0.000,   0.500,   1.000, };
    x={ -0.900,  -0.700,  -0.500,  -0.300,   0.000,   0.300,   0.500,   0.700,   0.900, };
    v={
      {  0.000,   0.064,   0.050,   0.036,   0.015,   0.024,   0.030,   0.046,   0.000, },
      {  0.000,   0.000,   0.050,   0.036,   0.015,   0.024,   0.030,   0.000,   0.000, },
      {  0.000,   0.000,   0.000,   0.036,   0.015,   0.024,   0.000,   0.000,   0.000, },
      };
echo:  Pr, 0

retained parameters (rp):
  debug=0;*v<>
  delta_q=  0.000;*Ca<>
  t_last= 25.000; deg C
  delta_q_model=       0.0;*Ca<>,*Cm<>
  t_last_model= 25.000; deg C
  shunt_gain_sclr=   1.000; A
  ib_scale_amp=   0.892;*SA<> A
  ib_bias_amp=  -0.240;*DA<> A
  ib_scale_noa=   0.940;*SB<> A
  ib_bias_noa= -1.100;*DB<> A
  ib_bias_all=  0.000;*Di<> A 
  ib_select=0;*s<> -1=noa, 0=auto, 1=amp
  vb_bias=  1.500;*Dv,*Dc<> V
  modeling=15;*Xm<>
  amp=  0.000;*Xa<> A pk
  freq=  0.000;*Xf<> r/s
  type=1;*Xt<> 0=sin, 1=sq, 2=tri
  inj_bias=  0.000; A
  tb_bias_hdwe=  0.000;*Dt<> deg C
  s_cap_model=  1.000;*Sc<>
  cutback_gain_scalar=  1.000;*Sk<>
  isum=62;
  delta_q_cinf_amp=  -390240.0; C
  delta_q_dinf_amp=   390240.0; C
  delta_q_cinf_noa= -390240.0; C
  delta_q_dinf_noa=  390240.0; C
  hys_scale=  0.300;*Sh
  tweak_sclr_amp=  1.000;*Mk<>
  tweak_sclr_noa=  1.000;*Nk<>
  nP= 1.00;*BP<> e.g. '2P1S'
  nS= 1.00;*BS<> e.g. '2P1S'
  mon_mod=0;*Bm<> 0=Battle, 1=LION
  sim_mod=0;*Bs<> 0=Battle, 1=LION

command parameters(cp):
 enable_wifi=0; w
 model_cutback=1;
 model_saturated=1;
 soft_reset=0;
 write_summary=0;
 ib_tot_bias_amp=  0.000;
 ib_tot_bias_noa=  0.000;
 dc_dc_on=0;
 blynking=0; z
 publishS=1;
 tb_bias_mode=  0.000;
 s_t_sat=  1.000;
echo:  PM, 0

Tweak::Shunt(Amp)::
 port=0x49;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.892; A
 v2a_s=-272.05; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(Amp)::Tweak(Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.031019; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(Amp)::Adafruit_ADS1x15 (Amp):
 m_bitShift =      4;
 m_gain =       2048;
 s_gain =       1024;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (Amp):
  _addr =        0x49;
  _begun =          1;
  _maxBufferSize = 32;
Shunt(Amp)::
 port=0x49;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.892; A
 v2a_s=-272.05; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(Amp)::Tweak(Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.031020; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(Amp)::Adafruit_ADS1x15 (Amp):
 m_bitShift =      4;
 m_gain =       2048;
 s_gain =       1024;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (Amp):
  _addr =        0x49;
  _begun =          1;
  _maxBufferSize = 32;
echo:  PN, 0

Tweak::Shunt(No Amp)::
 port=0x48;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.940; A
 v2a_s=-1376.99; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(No Amp)::Tweak(No Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.031047; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(No Amp)::Adafruit_ADS1x15 (No Amp):
 m_bitShift =      4;
 m_gain =       2560;
 s_gain =       2560;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (No Amp):
  _addr =        0x48;
  _begun =          1;
  _maxBufferSize = 32;
Shunt(No Amp)::
 port=0x48;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.940; A
 v2a_s=-1376.99; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(No Amp)::Tweak(No Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.031048; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(No Amp)::Adafruit_ADS1x15 (No Amp):
 m_bitShift =      4;
 m_gain =       2560;
 s_gain =       2560;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (No Amp):
  _addr =        0x48;
  _begun =          1;
  _maxBufferSize = 32;
echo:  Pf, 0

Sen::Fault:
 cc_diff   -0.000  thr=  0.200 Fc^
 ib_diff    0.000  thr= 10.000 Fd^
 e_wrap    -0.022  thr=-246.000 Fo^393.600 Fi^
 ib_quiet   0.000  thr=  0.005 Fq v

 soc    1.000  voc  14.450  voc_soc  14.450
 dis_tb_fa 0  dis_vb_fa 0  dis_ib_fa 0
 bms_off   0

 Tbh=  0.000  Tbm= 25.000
 Vbh  13.204  Vbm  14.450
 imh   0.000  imm   0.000
 inh   0.000  inm   0.000

 mod_tb  1  mod_vb  1  mod_ib  1
 tb_s_st 1  vb_s_st 1  ib_s_st 1

 bare n  0  x 
 bare m  0  x 
 ib_dsc  0  0 'Fq v'
 ibd_lo  0  0 'Fd ^  *SA/*SB'
 ibd_hi  0  0 'Fd ^  *SA/*SB'
 loss wv 0  0   'Fd, Fi/Fo ^'
 wl      0  0 'Fo ^'
 wh      0  0 'Fi ^'
 cc_dif  x  0 'Fc ^'
 ib n    0  0 'Fi 1'
 ib m    0  0 'Fi 1'
 vb      0  0 'Fv 1  *Dc/*Dv'
 tb      0  0 'Ft 1'
  0000000000000   00000000000
  CBA98765x3210 xxA9876543210
  fltw=0     falw=0
echo:  Xs0.1, 0
s_t_sat     1.0 s to 
    0.1
echo:  Xf0.02, 0
Injected freq set   0.020 Hz =   0.126 r/s
echo:  XW5, 0
Wait     5.0 s to inj
echo:  XT5, 0
Wait     5.0 s tail after
echo:  Xa-2000, 0
Inj amp set -2000.000 & inj_bias set   0.000
echo:  XC20, 0
#inj cycles to  20.000
echo:  v0, 0
echo:  W2, 0
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  XR, 0
RUN: at 174025,  20.000 cycles 179025 to 1179025 with 5000 wait and 5000 tail
          Tweak(Amp)::ignore:, cinf= -390240.0, dinf=  385994.9, delta_soc=  0.995, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(No Amp)::ignore:, cinf= -390240.0, dinf=  385994.9, delta_soc=  0.995, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(Amp)::ignore:, cinf=   31782.8, dinf=  -31695.5, delta_soc= -0.081, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(No Amp)::ignore:, cinf=   31782.8, dinf=  -31695.5, delta_soc= -0.081, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(Amp)::ignore:, cinf=   31782.8, dinf=  -31830.6, delta_soc= -0.082, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(No Amp)::ignore:, cinf=   31782.8, dinf=  -31830.6, delta_soc= -0.082, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
Hi!
Init DISPLAY
DISP allocated
Init CLOUD...done CLOUD
          local    memory
bias amp  -0.940    -0.240
bias noa  -0.170    -1.100
sclr amp   0.984     0.892
sclr noa   1.033     0.940
mon chem 0   0
sim chem 0   0
Do you wish to reset to local? [Y/n]: N
moving on....
End setup()
SHUNT MON Amp init
SHUNT MON No Amp init
echo:  S, 4
echo:  S, 0
  ? 'h'
echo:  XS, 4
echo:  XS, 0
STOP
echo:  Ca1, 4
echo:  Ca1, 0
soc=  1.000, modeling = 15, delta_q=  0.000, soc_model=  1.0000,   delta_q_model=  0.000, soc_ekf=  0.9996, delta_q_ekf=-158.856,
soft reset...
echo:  W3, 0
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  Xp9, 4
echo:  Xp9, 0
echo:  Dm1, 0
ShuntAmp.add    0.000 to   1.000
echo:  Dn1, 0
ShuntNoAmp.add   0.000 to   1.000
echo:  Xp0, 0
echo:  Xf0., 0
Injected freq set   0.000 Hz =   0.000 r/s
echo:  Xa0.XS, 0
Inj amp set   0.000 & inj_bias set   0.000
echo:  Mk1, 0
amp tweak_sclr   1.000 to   1.000
echo:  Nk1, 0
Noa tweak_sclr   1.000 to   1.000
echo:  Dn0.998500Xs1.0, 0
ShuntNoAmp.add   1.000 to   0.998
echo:  Di0, 0
rp.ib_bias_all   0.000 to   0.000
echo:  Dm0, 0
ShuntAmp.add    1.000 to   0.000
echo:  Dn0, 0
ShuntNoAmp.add   0.998 to   0.000
echo:  Dv0, 0
Sen->vb_add   0.000 to   0.000
echo:  DT0, 0
Sen.Tb_noise_amp_   0.000 to   0.000
echo:  DV0.0, 0
Sen.Vb_noise_amp_   0.000 to   0.000
echo:  DI0, 0
I ? 'h'
echo:  Xu0, 0
Fail tb 0 to 0
echo:  Xv1., 0
Stale tb time sclr    1.0000 to    1.0000
echo:  Dr100, 0
ReadSensors 100 to 100
echo:  DP4, 0
Print interval 4 to 4
echo:  v0, 0
echo:  Bm0, 0
Mon chem 0 to 0
soft reset...
echo:  Bs0, 0
Sim chem 0 to 0
soft reset...
echo:  Xm15, 0
modeling 15 to 15
Modeling 15
tweak_test 1
mod_ib 1
mod_vb 1
mod_tb 1
echo:  Xts, 0
Set sin.  rp.type = 1
echo:  Ca1, 0
soc=  1.000, modeling = 15, delta_q=  0.000, soc_model=  1.0000,   delta_q_model=  0.000, soc_ekf=  1.0000, delta_q_ekf= -0.394,
soft reset...
echo:  W3, 0
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  Ri, 0
Amp chg CC -388936.8 to -390240.0
Amp dchg CC  390240.0 to  390240.0
Noa chg CC -388936.8 to -390240.0
Noa dchg CC  390240.0 to  390240.0
echo:  Mw0, 0
Amp->time_to_wait   6.000 to   0.000
echo:  Nw0, 0
Noa->time_to_wait   6.000 to   0.000
echo:  MC0.004, 0
Amp->max_change_   0.001000 to   0.004000
echo:  Mx0.04, 0
Amp->max_tweak   0.010 to   0.040
echo:  NC0.004, 0
Noa->max_change_   0.001000 to   0.004000
echo:  Nx0.04, 0
Noa->max_tweak   0.010 to   0.040
echo:  Mk1, 0
amp tweak_sclr   1.000 to   1.000
echo:  Nk1, 0
Noa tweak_sclr   1.000 to   1.000
echo:  DP2, 0
Print interval 4 to 2
echo:  Rb, 0
echo:  Pa, 0
echo:  Pm, 0
BM::Battery:
  temp_c= 25.000; dg C
 *rp_delt_q=       0.0;  C
 *rp_t_last=      25.0; dg C
  dvoc_dt=  0.004000; V/dg C
  r_0=  0.003000;  ohm
  r_ct =   0.001600;  ohm
  tau_ct=  0.200000;  s (=1/Rct/Cct)
  r_diff=  0.007700;  ohm
  tau_diff = 83.000000;  s (=1/Rdif/Cdif)
  r_sd =  70.000000;  ohm
  tau_sd=25000000.0;  s
  bms_off=0;
  dv_dsoc=122.984123; V/frac
  ib=  0.000; A
  Ib=  0.000; Bank, A
  vb= 14.450; V
  Vb= 14.450; Bank, V
  voc= 14.450; V
  voc_stat= 14.450; V
  vsat= 13.800; V
  dv_dyn=   0.000; V
  sr=  1.000; sclr
  dt=  0.100; s
 *rp_nP= 1.00; P bank, e.g. '2P1S'
 *rp_nS= 1.00; S bank, e.g. '2P1S'
 BM::BM:
  ah_rem_ekf_=105.690; A-h
  ah_rem_soc_=105.690; A-h
  EKF_conv=0;
  q_ekf=  390239.6; C
  soc_ekf=  1.0000; frac
  tcharge= 24.0; hr
  tcharge_ekf=  0.0; hr
  voc_filt= 14.497; V
  voc_stat= 14.450; V
  y_filt=  0.055; Res EKF, V
Coulombs:
 q_cap_rated= 390240.0; At t_rated, C
 q_cap_rated_scaled= 390240.0; Act at t_rated_, C
 q_capacity= 390240.0; Sat q at temp, C
 q= 390240.0; Avail, except q_min_, C
 q_min=   9756.0; Low volt shutdown, C
 delta_q      0.0; Change since sat, C
 soc=  1.0000; Frac of q_cap avail (0-1);
 sat=1; T=saturated
 t_rated= 25.0; Rated, dg C
 t_last= 25.0; past, dg C
 t_rlim=  0.017; Tb RL, deg C / s
 resetting=0; Coord user testing of CC
 soc_min=  0.0250; soc BMS shuts off
 mod=Battleborn; Chem e.g. Battleborn or LION
 mod_code=0; Chem code
 coul_eff=  0.99850; Coul Eff
Coulombs::Chemistry:
  dqdt=  0.010; frac/dg C
  low_voc=  9.000; BMS turn off, V
  hys_cap=360000.000; F
  v_sat= 13.850; V
  dvoc_dt=  0.004; V/dg C
  dvoc= -0.050; Cal err, V
  Randles:   r_0= 0.003000; R0, ohm
   r_ct= 0.001600; Chg trans, ohm
   r_diff= 0.007700; Diffusion, ohm
   tau_ct=  0.200; ct, s (=1/Rct/Cct)
   tau_diff= 83.000; diff, s (=1/Rdiff/Cdiff)
  tau_sd=25000000.000; EKF. Parasitic disch, s
  r_sd= 70.000; EKF. Parasitic disch, ohm
  r_ss=  0.012; SS init, ohm
  voc(t, soc):
    y={  5.000,  11.100,  20.000,  30.000,  40.000, };
    x={ -0.150,   0.000,   0.050,   0.100,   0.140,   0.170,   0.200,   0.250,   0.300,   0.400,   0.500,   0.600,   0.700,   0.800,   0.900,   0.990,   0.995,   1.000, };
    v={
      {  4.000,   4.000,   4.000,   4.000,  10.200,  11.700,  12.450,  12.700,  12.770,  12.900,  12.910,  12.980,  13.050,  13.110,  13.170,  13.220,  13.590,  14.450, },
      {  4.000,   4.000,   4.000,   9.500,  12.000,  12.500,  12.700,  12.800,  12.900,  12.960,  13.010,  13.060,  13.110,  13.170,  13.200,  13.230,  13.600,  14.460, },
      {  4.000,   4.000,  10.000,  12.600,  12.770,  12.850,  12.890,  12.950,  12.990,  13.030,  13.040,  13.090,  13.140,  13.210,  13.250,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,  12.000,  12.650,  12.750,  12.800,  12.850,  12.950,  13.000,  13.080,  13.120,  13.160,  13.200,  13.240,  13.260,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,   4.000,   4.000,  10.500,  11.930,  12.780,  12.830,  12.890,  12.970,  13.060,  13.100,  13.130,  13.160,  13.190,  13.200,  13.720,  14.500, },
      };
  soc_min(temp_c):
    x={  5.000,  11.100,  20.000,  30.000,  40.000, };
    v={  0.100,   0.070,   0.050,   0.000,   0.200, };
StateSpace:
  dt =  0.100000
   A  =  [ -5.000000,  0.000000,
           0.000000, -0.012048];
   x  =  [  0.000000,  0.000000];
   B  =  [  0.008000,  0.000000,
           0.000093,  0.000000];
   u  =  [  0.000000, 14.450000];
   C  =  [ -1.000000, -1.000000];
   D  =  [ -0.003000,  1.000000];
   x_dot  =  [  0.000000,  0.000000];
   y  =  [ 14.450000];
   AinvB =  [  0.001600,  0.000000,
           0.007700,  0.000000];
  ::Hysteresis:
  res=0.0150; Null, Ohm
  cap=  360000.0; F
  tau=    5400.0; Null, s
  ib=  0.000; In, A
  ioc=  0.000; Out, A
  soc=  1.0000; Input
  res=  0.015; Var, ohm
  dv_dot=  0.000; V/s
  dv_hys=  0.000; Delta state, V
  disabled=0; input < 1e-5
 *rp_hys_scale=  0.30; Slr
  r(soc, dv):
    y={  0.000,   0.500,   1.000, };
    x={ -0.900,  -0.700,  -0.500,  -0.300,   0.000,   0.300,   0.500,   0.700,   0.900, };
    v={
      {  0.000,   0.064,   0.050,   0.036,   0.015,   0.024,   0.030,   0.046,   0.000, },
      {  0.000,   0.000,   0.050,   0.036,   0.015,   0.024,   0.030,   0.000,   0.000, },
      {  0.000,   0.000,   0.000,   0.036,   0.015,   0.024,   0.000,   0.000,   0.000, },
      };
EKF_1x1:
Inputs:
  z  =    14.4500;  // 1x1 input, =voc, dynamic predicted by other model, V
  R  =   0.250000;  // 1x1 Kalman state uncertainty
  Q  =   0.000000;  // 1x1 Kalman process uncertainty
  H  =    122.984;  // 1x1 Jacobian sensitivity dV/dSOC
Outputs:
  x  =     1.0000;  // 1x1 Kalman state variable = Vsoc (0-1 fraction)
  hx =    14.4498;  // Output of observation function h(x)
  y  =     0.0002;  // 1x1 Residual z-hx, V
  P  =   0.000000;  // 1x1 Kalman uncertainty covariance
  K  =   0.000021;  // 1x1 Kalman gain
  S  =   0.250634;  // 1x1 system uncertainty
echo:  Ps, 0

modeling=15
S:BS::Battery:
  temp_c= 25.000; dg C
 *rp_delt_q=       0.0;  C
 *rp_t_last=      25.0; dg C
  dvoc_dt=  0.004000; V/dg C
  r_0=  0.003000;  ohm
  r_ct =   0.001600;  ohm
  tau_ct=  0.200000;  s (=1/Rct/Cct)
  r_diff=  0.007700;  ohm
  tau_diff = 83.000000;  s (=1/Rdif/Cdif)
  r_sd =  70.000000;  ohm
  tau_sd=25000000.0;  s
  bms_off=0;
  dv_dsoc=122.999954; V/frac
  ib=  0.000; A
  Ib=  0.000; Bank, A
  vb= 14.450; V
  Vb= 14.450; Bank, V
  voc= 14.450; V
  voc_stat= 14.450; V
  vsat= 13.800; V
  dv_dyn=   0.000; V
  sr=  1.000; sclr
  dt=  0.100; s
 *rp_nP= 1.00; P bank, e.g. '2P1S'
 *rp_nS= 1.00; S bank, e.g. '2P1S'
 BS::BS:
  sat_ib_max=  0.000; A
  sat_ib_null=  0.000; A
  sat_cutback_gain= 1000.0; voc>vsat
  model_cutback=1;
  model_saturated=1;
  ib=  0.000; A
  ib_in=  0.000; Saved, A
  ib_fut=  0.000; A
  ib_sat=  0.500;
 *rp_s_cap_model=  1.000; Slr
S::Coulombs:
 q_cap_rated= 390240.0; At t_rated, C
 q_cap_rated_scaled= 390240.0; Act at t_rated_, C
 q_capacity= 390240.0; Sat q at temp, C
 q= 390240.0; Avail, except q_min_, C
 q_min=   9756.0; Low volt shutdown, C
 delta_q      0.0; Change since sat, C
 soc=  1.0000; Frac of q_cap avail (0-1);
 sat=1; T=saturated
 t_rated= 25.0; Rated, dg C
 t_last= 25.0; past, dg C
 t_rlim=  0.017; Tb RL, deg C / s
 resetting=0; Coord user testing of CC
 soc_min=  0.0250; soc BMS shuts off
 mod=Battleborn; Chem e.g. Battleborn or LION
 mod_code=0; Chem code
 coul_eff=  0.99850; Coul Eff
Coulombs::Chemistry:
  dqdt=  0.010; frac/dg C
  low_voc=  9.000; BMS turn off, V
  hys_cap=360000.000; F
  v_sat= 13.850; V
  dvoc_dt=  0.004; V/dg C
  dvoc= -0.050; Cal err, V
  Randles:   r_0= 0.003000; R0, ohm
   r_ct= 0.001600; Chg trans, ohm
   r_diff= 0.007700; Diffusion, ohm
   tau_ct=  0.200; ct, s (=1/Rct/Cct)
   tau_diff= 83.000; diff, s (=1/Rdiff/Cdiff)
  tau_sd=25000000.000; EKF. Parasitic disch, s
  r_sd= 70.000; EKF. Parasitic disch, ohm
  r_ss=  0.012; SS init, ohm
  voc(t, soc):
    y={  5.000,  11.100,  20.000,  30.000,  40.000, };
    x={ -0.150,   0.000,   0.050,   0.100,   0.140,   0.170,   0.200,   0.250,   0.300,   0.400,   0.500,   0.600,   0.700,   0.800,   0.900,   0.990,   0.995,   1.000, };
    v={
      {  4.000,   4.000,   4.000,   4.000,  10.200,  11.700,  12.450,  12.700,  12.770,  12.900,  12.910,  12.980,  13.050,  13.110,  13.170,  13.220,  13.590,  14.450, },
      {  4.000,   4.000,   4.000,   9.500,  12.000,  12.500,  12.700,  12.800,  12.900,  12.960,  13.010,  13.060,  13.110,  13.170,  13.200,  13.230,  13.600,  14.460, },
      {  4.000,   4.000,  10.000,  12.600,  12.770,  12.850,  12.890,  12.950,  12.990,  13.030,  13.040,  13.090,  13.140,  13.210,  13.250,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,  12.000,  12.650,  12.750,  12.800,  12.850,  12.950,  13.000,  13.080,  13.120,  13.160,  13.200,  13.240,  13.260,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,   4.000,   4.000,  10.500,  11.930,  12.780,  12.830,  12.890,  12.970,  13.060,  13.100,  13.130,  13.160,  13.190,  13.200,  13.720,  14.500, },
      };
  soc_min(temp_c):
    x={  5.000,  11.100,  20.000,  30.000,  40.000, };
    v={  0.100,   0.070,   0.050,   0.000,   0.200, };
S::StateSpace:
  dt =  0.100000
   A  =  [ -5.000000,  0.000000,
           0.000000, -0.012048];
   x  =  [  0.000000,  0.000000];
   B  =  [  0.008000,  0.000000,
           0.000093,  0.000000];
   u  =  [  0.000000, 14.450000];
   C  =  [  1.000000,  1.000000];
   D  =  [  0.003000,  1.000000];
   x_dot  =  [  0.000000,  0.000000];
   y  =  [ 14.450000];
   AinvB =  [  0.001600,  0.000000,
           0.007700,  0.000000];
  ::Hysteresis:
  res=0.0150; Null, Ohm
  cap=  360000.0; F
  tau=    5400.0; Null, s
  ib=  0.000; In, A
  ioc=  0.000; Out, A
  soc=  1.0000; Input
  res=  0.015; Var, ohm
  dv_dot=  0.000; V/s
  dv_hys=  0.000; Delta state, V
  disabled=0; input < 1e-5
 *rp_hys_scale=  0.30; Slr
  r(soc, dv):
    y={  0.000,   0.500,   1.000, };
    x={ -0.900,  -0.700,  -0.500,  -0.300,   0.000,   0.300,   0.500,   0.700,   0.900, };
    v={
      {  0.000,   0.064,   0.050,   0.036,   0.015,   0.024,   0.030,   0.046,   0.000, },
      {  0.000,   0.000,   0.050,   0.036,   0.015,   0.024,   0.030,   0.000,   0.000, },
      {  0.000,   0.000,   0.000,   0.036,   0.015,   0.024,   0.000,   0.000,   0.000, },
      };
echo:  Pr, 0

retained parameters (rp):
  debug=0;*v<>
  delta_q=  0.000;*Ca<>
  t_last= 25.000; deg C
  delta_q_model=       0.0;*Ca<>,*Cm<>
  t_last_model= 25.000; deg C
  shunt_gain_sclr=   1.000; A
  ib_scale_amp=   0.892;*SA<> A
  ib_bias_amp=  -0.240;*DA<> A
  ib_scale_noa=   0.940;*SB<> A
  ib_bias_noa= -1.100;*DB<> A
  ib_bias_all=  0.000;*Di<> A 
  ib_select=0;*s<> -1=noa, 0=auto, 1=amp
  vb_bias=  1.500;*Dv,*Dc<> V
  modeling=15;*Xm<>
  amp=  0.000;*Xa<> A pk
  freq=  0.000;*Xf<> r/s
  type=1;*Xt<> 0=sin, 1=sq, 2=tri
  inj_bias=  0.000; A
  tb_bias_hdwe=  0.000;*Dt<> deg C
  s_cap_model=  1.000;*Sc<>
  cutback_gain_scalar=  1.000;*Sk<>
  isum=62;
  delta_q_cinf_amp=  -390240.0; C
  delta_q_dinf_amp=   390240.0; C
  delta_q_cinf_noa= -390240.0; C
  delta_q_dinf_noa=  390240.0; C
  hys_scale=  0.300;*Sh
  tweak_sclr_amp=  1.000;*Mk<>
  tweak_sclr_noa=  1.000;*Nk<>
  nP= 1.00;*BP<> e.g. '2P1S'
  nS= 1.00;*BS<> e.g. '2P1S'
  mon_mod=0;*Bm<> 0=Battle, 1=LION
  sim_mod=0;*Bs<> 0=Battle, 1=LION

command parameters(cp):
 enable_wifi=0; w
 model_cutback=1;
 model_saturated=1;
 soft_reset=0;
 write_summary=0;
 ib_tot_bias_amp=  0.000;
 ib_tot_bias_noa=  0.000;
 dc_dc_on=0;
 blynking=0; z
 publishS=1;
 tb_bias_mode=  0.000;
 s_t_sat=  1.000;
echo:  PM, 0

Tweak::Shunt(Amp)::
 port=0x49;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.892; A
 v2a_s=-272.05; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(Amp)::Tweak(Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.006575; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(Amp)::Adafruit_ADS1x15 (Amp):
 m_bitShift =      4;
 m_gain =       2048;
 s_gain =       1024;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (Amp):
  _addr =        0x49;
  _begun =          1;
  _maxBufferSize = 32;
Shunt(Amp)::
 port=0x49;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.892; A
 v2a_s=-272.05; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(Amp)::Tweak(Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.006576; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(Amp)::Adafruit_ADS1x15 (Amp):
 m_bitShift =      4;
 m_gain =       2048;
 s_gain =       1024;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (Amp):
  _addr =        0x49;
  _begun =          1;
  _maxBufferSize = 32;
echo:  PN, 0

Tweak::Shunt(No Amp)::
 port=0x48;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.940; A
 v2a_s=-1376.99; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(No Amp)::Tweak(No Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.006603; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(No Amp)::Adafruit_ADS1x15 (No Amp):
 m_bitShift =      4;
 m_gain =       2560;
 s_gain =       2560;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (No Amp):
  _addr =        0x48;
  _begun =          1;
  _maxBufferSize = 32;
Shunt(No Amp)::
 port=0x48;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.940; A
 v2a_s=-1376.99; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(No Amp)::Tweak(No Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.006604; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(No Amp)::Adafruit_ADS1x15 (No Amp):
 m_bitShift =      4;
 m_gain =       2560;
 s_gain =       2560;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (No Amp):
  _addr =        0x48;
  _begun =          1;
  _maxBufferSize = 32;
echo:  Pf, 0

Sen::Fault:
 cc_diff   -0.000  thr=  0.200 Fc^
 ib_diff    0.000  thr= 10.000 Fd^
 e_wrap     0.000  thr=-246.000 Fo^393.600 Fi^
 ib_quiet   0.000  thr=  0.005 Fq v

 soc    1.000  voc  14.450  voc_soc  14.450
 dis_tb_fa 0  dis_vb_fa 0  dis_ib_fa 0
 bms_off   0

 Tbh=  0.000  Tbm= 25.000
 Vbh  13.204  Vbm  14.450
 imh   0.000  imm   0.000
 inh   0.000  inm   0.000

 mod_tb  1  mod_vb  1  mod_ib  1
 tb_s_st 1  vb_s_st 1  ib_s_st 1

 bare n  0  x 
 bare m  0  x 
 ib_dsc  0  0 'Fq v'
 ibd_lo  0  0 'Fd ^  *SA/*SB'
 ibd_hi  0  0 'Fd ^  *SA/*SB'
 loss wv 0  0   'Fd, Fi/Fo ^'
 wl      0  0 'Fo ^'
 wh      0  0 'Fi ^'
 cc_dif  x  0 'Fc ^'
 ib n    0  0 'Fi 1'
 ib m    0  0 'Fi 1'
 vb      0  0 'Fv 1  *Dc/*Dv'
 tb      0  0 'Ft 1'
  0000000000000   00000000000
  CBA98765x3210 xxA9876543210
  fltw=0     falw=0
echo:  Xs0.1, 0
s_t_sat     1.0 s to 
    0.1
echo:  Xf0.02, 0
Injected freq set   0.020 Hz =   0.126 r/s
echo:  XW5, 0
Wait     5.0 s to inj
echo:  XT5, 0
Wait     5.0 s tail after
echo:  Xa-6000, 0
Inj amp set -6000.000 & inj_bias set   0.000
echo:  XC20, 0
#inj cycles to  20.000
echo:  v0, 0
echo:  W2, 0
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  XR, 0
RUN: at 28044,  20.000 cycles 33044 to 1033044 with 5000 wait and 5000 tail
          Tweak(Amp)::ignore:, cinf= -390240.0, dinf=  383283.1, delta_soc=  0.991, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(No Amp)::ignore:, cinf= -390240.0, dinf=  383283.1, delta_soc=  0.991, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(Amp)::ignore:, cinf=   95350.3, dinf=  -95052.0, delta_soc= -0.244, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(No Amp)::ignore:, cinf=   95350.3, dinf=  -95052.0, delta_soc= -0.244, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(Amp)::ignore:, cinf=   95350.3, dinf=  -95194.2, delta_soc= -0.244, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(No Amp)::ignore:, cinf=   95350.3, dinf=  -95194.2, delta_soc= -0.244, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(Amp)::ignore:, cinf=   95350.3, dinf=  -95200.8, delta_soc= -0.244, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(No Amp)::ignore:, cinf=   95350.3, dinf=  -95200.8, delta_soc= -0.244, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
Hi!
Init DISPLAY
DISP allocated
Init CLOUD...done CLOUD
          local    memory
bias amp  -0.940    -0.240
bias noa  -0.170    -1.100
sclr amp   0.984     0.892
sclr noa   1.033     0.940
mon chem 0   0
sim chem 0   0
Do you wish to reset to local? [Y/n]: N
moving on....
End setup()
SHUNT MON Amp init
SHUNT MON No Amp init
echo:  Ca1, 4
echo:  Ca1, 0
soc=  1.000, modeling = 15, delta_q=  0.000, soc_model=  1.0000,   delta_q_model=  0.000, soc_ekf=  0.9973, delta_q_ekf=-1048.178,
soft reset...
echo:  W3, 0
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  Xp9, 4
echo:  Xp9, 0
echo:  Dm1, 0
ShuntAmp.add    0.000 to   1.000
echo:  Dn1, 0
ShuntNoAmp.add   0.000 to   1.000
echo:  Xp0, 0
echo:  Xf0., 0
Injected freq set   0.000 Hz =   0.000 r/s
echo:  Xa0.XS, 0
Inj amp set   0.000 & inj_bias set   0.000
echo:  Mk1, 0
amp tweak_sclr   1.000 to   1.000
echo:  Nk1, 0
Noa tweak_sclr   1.000 to   1.000
echo:  Dn0.998500Xs1.0, 0
ShuntNoAmp.add   1.000 to   0.998
echo:  Di0, 0
rp.ib_bias_all   0.000 to   0.000
echo:  Dm0, 0
ShuntAmp.add    1.000 to   0.000
echo:  Dn0, 0
ShuntNoAmp.add   0.998 to   0.000
echo:  Dv0, 0
Sen->vb_add  -0.000 to   0.000
echo:  DT0, 0
Sen.Tb_noise_amp_   0.000 to   0.000
echo:  DV0.0, 0
Sen.Vb_noise_amp_   0.000 to   0.000
echo:  DI0, 0
I ? 'h'
echo:  Xu0, 0
Fail tb 0 to 0
echo:  Xv1., 0
Stale tb time sclr    1.0000 to    1.0000
echo:  Dr100, 0
ReadSensors 100 to 100
echo:  DP4, 0
Print interval 4 to 4
echo:  v0, 0
echo:  Bm0, 0
Mon chem 0 to 0
soft reset...
echo:  Bs0, 0
Sim chem 0 to 0
soft reset...
echo:  Xm15, 0
modeling 15 to 15
Modeling 15
tweak_test 1
mod_ib 1
mod_vb 1
mod_tb 1
echo:  Xts, 0
Set sin.  rp.type = 1
echo:  Ca1, 0
soc=  1.000, modeling = 15, delta_q=  0.000, soc_model=  1.0000,   delta_q_model=  0.000, soc_ekf=  1.0000, delta_q_ekf= -0.394,
soft reset...
echo:  W3, 0
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  Ri, 0
Amp chg CC -390239.9 to -390240.0
Amp dchg CC  347864.2 to  390240.0
Noa chg CC -390239.9 to -390240.0
Noa dchg CC  347864.2 to  390240.0
echo:  Mw0, 0
Amp->time_to_wait   6.000 to   0.000
echo:  Nw0, 0
Noa->time_to_wait   6.000 to   0.000
echo:  MC0.004, 0
Amp->max_change_   0.001000 to   0.004000
echo:  Mx0.04, 0
Amp->max_tweak   0.010 to   0.040
echo:  NC0.004, 0
Noa->max_change_   0.001000 to   0.004000
echo:  Nx0.04, 0
Noa->max_tweak   0.010 to   0.040
echo:  Mk1, 0
amp tweak_sclr   1.000 to   1.000
echo:  Nk1, 0
Noa tweak_sclr   1.000 to   1.000
echo:  DP2, 0
Print interval 4 to 2
echo:  Rb, 0
echo:  Pa, 0
echo:  Pm, 0
BM::Battery:
  temp_c= 25.000; dg C
 *rp_delt_q=       0.0;  C
 *rp_t_last=      25.0; dg C
  dvoc_dt=  0.004000; V/dg C
  r_0=  0.003000;  ohm
  r_ct =   0.001600;  ohm
  tau_ct=  0.200000;  s (=1/Rct/Cct)
  r_diff=  0.007700;  ohm
  tau_diff = 83.000000;  s (=1/Rdif/Cdif)
  r_sd =  70.000000;  ohm
  tau_sd=25000000.0;  s
  bms_off=0;
  dv_dsoc=122.984123; V/frac
  ib=  0.000; A
  Ib=  0.000; Bank, A
  vb= 14.450; V
  Vb= 14.450; Bank, V
  voc= 14.450; V
  voc_stat= 14.450; V
  vsat= 13.800; V
  dv_dyn=   0.000; V
  sr=  1.000; sclr
  dt=  0.100; s
 *rp_nP= 1.00; P bank, e.g. '2P1S'
 *rp_nS= 1.00; S bank, e.g. '2P1S'
 BM::BM:
  ah_rem_ekf_=105.690; A-h
  ah_rem_soc_=105.690; A-h
  EKF_conv=0;
  q_ekf=  390239.6; C
  soc_ekf=  1.0000; frac
  tcharge= 24.0; hr
  tcharge_ekf=  0.0; hr
  voc_filt= 14.400; V
  voc_stat= 14.450; V
  y_filt= -0.129; Res EKF, V
Coulombs:
 q_cap_rated= 390240.0; At t_rated, C
 q_cap_rated_scaled= 390240.0; Act at t_rated_, C
 q_capacity= 390240.0; Sat q at temp, C
 q= 390240.0; Avail, except q_min_, C
 q_min=   9756.0; Low volt shutdown, C
 delta_q      0.0; Change since sat, C
 soc=  1.0000; Frac of q_cap avail (0-1);
 sat=1; T=saturated
 t_rated= 25.0; Rated, dg C
 t_last= 25.0; past, dg C
 t_rlim=  0.017; Tb RL, deg C / s
 resetting=0; Coord user testing of CC
 soc_min=  0.0250; soc BMS shuts off
 mod=Battleborn; Chem e.g. Battleborn or LION
 mod_code=0; Chem code
 coul_eff=  0.99850; Coul Eff
Coulombs::Chemistry:
  dqdt=  0.010; frac/dg C
  low_voc=  9.000; BMS turn off, V
  hys_cap=360000.000; F
  v_sat= 13.850; V
  dvoc_dt=  0.004; V/dg C
  dvoc= -0.050; Cal err, V
  Randles:   r_0= 0.003000; R0, ohm
   r_ct= 0.001600; Chg trans, ohm
   r_diff= 0.007700; Diffusion, ohm
   tau_ct=  0.200; ct, s (=1/Rct/Cct)
   tau_diff= 83.000; diff, s (=1/Rdiff/Cdiff)
  tau_sd=25000000.000; EKF. Parasitic disch, s
  r_sd= 70.000; EKF. Parasitic disch, ohm
  r_ss=  0.012; SS init, ohm
  voc(t, soc):
    y={  5.000,  11.100,  20.000,  30.000,  40.000, };
    x={ -0.150,   0.000,   0.050,   0.100,   0.140,   0.170,   0.200,   0.250,   0.300,   0.400,   0.500,   0.600,   0.700,   0.800,   0.900,   0.990,   0.995,   1.000, };
    v={
      {  4.000,   4.000,   4.000,   4.000,  10.200,  11.700,  12.450,  12.700,  12.770,  12.900,  12.910,  12.980,  13.050,  13.110,  13.170,  13.220,  13.590,  14.450, },
      {  4.000,   4.000,   4.000,   9.500,  12.000,  12.500,  12.700,  12.800,  12.900,  12.960,  13.010,  13.060,  13.110,  13.170,  13.200,  13.230,  13.600,  14.460, },
      {  4.000,   4.000,  10.000,  12.600,  12.770,  12.850,  12.890,  12.950,  12.990,  13.030,  13.040,  13.090,  13.140,  13.210,  13.250,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,  12.000,  12.650,  12.750,  12.800,  12.850,  12.950,  13.000,  13.080,  13.120,  13.160,  13.200,  13.240,  13.260,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,   4.000,   4.000,  10.500,  11.930,  12.780,  12.830,  12.890,  12.970,  13.060,  13.100,  13.130,  13.160,  13.190,  13.200,  13.720,  14.500, },
      };
  soc_min(temp_c):
    x={  5.000,  11.100,  20.000,  30.000,  40.000, };
    v={  0.100,   0.070,   0.050,   0.000,   0.200, };
StateSpace:
  dt =  0.100000
   A  =  [ -5.000000,  0.000000,
           0.000000, -0.012048];
   x  =  [  0.000000,  0.000000];
   B  =  [  0.008000,  0.000000,
           0.000093,  0.000000];
   u  =  [  0.000000, 14.450000];
   C  =  [ -1.000000, -1.000000];
   D  =  [ -0.003000,  1.000000];
   x_dot  =  [  0.000000,  0.000000];
   y  =  [ 14.450000];
   AinvB =  [  0.001600,  0.000000,
           0.007700,  0.000000];
  ::Hysteresis:
  res=0.0150; Null, Ohm
  cap=  360000.0; F
  tau=    5400.0; Null, s
  ib=  0.000; In, A
  ioc=  0.000; Out, A
  soc=  1.0000; Input
  res=  0.015; Var, ohm
  dv_dot=  0.000; V/s
  dv_hys=  0.000; Delta state, V
  disabled=0; input < 1e-5
 *rp_hys_scale=  0.30; Slr
  r(soc, dv):
    y={  0.000,   0.500,   1.000, };
    x={ -0.900,  -0.700,  -0.500,  -0.300,   0.000,   0.300,   0.500,   0.700,   0.900, };
    v={
      {  0.000,   0.064,   0.050,   0.036,   0.015,   0.024,   0.030,   0.046,   0.000, },
      {  0.000,   0.000,   0.050,   0.036,   0.015,   0.024,   0.030,   0.000,   0.000, },
      {  0.000,   0.000,   0.000,   0.036,   0.015,   0.024,   0.000,   0.000,   0.000, },
      };
EKF_1x1:
Inputs:
  z  =    14.4500;  // 1x1 input, =voc, dynamic predicted by other model, V
  R  =   0.250000;  // 1x1 Kalman state uncertainty
  Q  =   0.000000;  // 1x1 Kalman process uncertainty
  H  =    122.984;  // 1x1 Jacobian sensitivity dV/dSOC
Outputs:
  x  =     1.0000;  // 1x1 Kalman state variable = Vsoc (0-1 fraction)
  hx =    14.4498;  // Output of observation function h(x)
  y  =     0.0002;  // 1x1 Residual z-hx, V
  P  =   0.000000;  // 1x1 Kalman uncertainty covariance
  K  =   0.000021;  // 1x1 Kalman gain
  S  =   0.250634;  // 1x1 system uncertainty
echo:  Ps, 0

modeling=15
S:BS::Battery:
  temp_c= 25.000; dg C
 *rp_delt_q=       0.0;  C
 *rp_t_last=      25.0; dg C
  dvoc_dt=  0.004000; V/dg C
  r_0=  0.003000;  ohm
  r_ct =   0.001600;  ohm
  tau_ct=  0.200000;  s (=1/Rct/Cct)
  r_diff=  0.007700;  ohm
  tau_diff = 83.000000;  s (=1/Rdif/Cdif)
  r_sd =  70.000000;  ohm
  tau_sd=25000000.0;  s
  bms_off=0;
  dv_dsoc=122.999954; V/frac
  ib=  0.000; A
  Ib=  0.000; Bank, A
  vb= 14.450; V
  Vb= 14.450; Bank, V
  voc= 14.450; V
  voc_stat= 14.450; V
  vsat= 13.800; V
  dv_dyn=   0.000; V
  sr=  1.000; sclr
  dt=  0.100; s
 *rp_nP= 1.00; P bank, e.g. '2P1S'
 *rp_nS= 1.00; S bank, e.g. '2P1S'
 BS::BS:
  sat_ib_max=  0.000; A
  sat_ib_null=  0.000; A
  sat_cutback_gain= 1000.0; voc>vsat
  model_cutback=1;
  model_saturated=1;
  ib=  0.000; A
  ib_in=  0.000; Saved, A
  ib_fut=  0.000; A
  ib_sat=  0.500;
 *rp_s_cap_model=  1.000; Slr
S::Coulombs:
 q_cap_rated= 390240.0; At t_rated, C
 q_cap_rated_scaled= 390240.0; Act at t_rated_, C
 q_capacity= 390240.0; Sat q at temp, C
 q= 390240.0; Avail, except q_min_, C
 q_min=   9756.0; Low volt shutdown, C
 delta_q      0.0; Change since sat, C
 soc=  1.0000; Frac of q_cap avail (0-1);
 sat=1; T=saturated
 t_rated= 25.0; Rated, dg C
 t_last= 25.0; past, dg C
 t_rlim=  0.017; Tb RL, deg C / s
 resetting=0; Coord user testing of CC
 soc_min=  0.0250; soc BMS shuts off
 mod=Battleborn; Chem e.g. Battleborn or LION
 mod_code=0; Chem code
 coul_eff=  0.99850; Coul Eff
Coulombs::Chemistry:
  dqdt=  0.010; frac/dg C
  low_voc=  9.000; BMS turn off, V
  hys_cap=360000.000; F
  v_sat= 13.850; V
  dvoc_dt=  0.004; V/dg C
  dvoc= -0.050; Cal err, V
  Randles:   r_0= 0.003000; R0, ohm
   r_ct= 0.001600; Chg trans, ohm
   r_diff= 0.007700; Diffusion, ohm
   tau_ct=  0.200; ct, s (=1/Rct/Cct)
   tau_diff= 83.000; diff, s (=1/Rdiff/Cdiff)
  tau_sd=25000000.000; EKF. Parasitic disch, s
  r_sd= 70.000; EKF. Parasitic disch, ohm
  r_ss=  0.012; SS init, ohm
  voc(t, soc):
    y={  5.000,  11.100,  20.000,  30.000,  40.000, };
    x={ -0.150,   0.000,   0.050,   0.100,   0.140,   0.170,   0.200,   0.250,   0.300,   0.400,   0.500,   0.600,   0.700,   0.800,   0.900,   0.990,   0.995,   1.000, };
    v={
      {  4.000,   4.000,   4.000,   4.000,  10.200,  11.700,  12.450,  12.700,  12.770,  12.900,  12.910,  12.980,  13.050,  13.110,  13.170,  13.220,  13.590,  14.450, },
      {  4.000,   4.000,   4.000,   9.500,  12.000,  12.500,  12.700,  12.800,  12.900,  12.960,  13.010,  13.060,  13.110,  13.170,  13.200,  13.230,  13.600,  14.460, },
      {  4.000,   4.000,  10.000,  12.600,  12.770,  12.850,  12.890,  12.950,  12.990,  13.030,  13.040,  13.090,  13.140,  13.210,  13.250,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,  12.000,  12.650,  12.750,  12.800,  12.850,  12.950,  13.000,  13.080,  13.120,  13.160,  13.200,  13.240,  13.260,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,   4.000,   4.000,  10.500,  11.930,  12.780,  12.830,  12.890,  12.970,  13.060,  13.100,  13.130,  13.160,  13.190,  13.200,  13.720,  14.500, },
      };
  soc_min(temp_c):
    x={  5.000,  11.100,  20.000,  30.000,  40.000, };
    v={  0.100,   0.070,   0.050,   0.000,   0.200, };
S::StateSpace:
  dt =  0.100000
   A  =  [ -5.000000,  0.000000,
           0.000000, -0.012048];
   x  =  [  0.000000,  0.000000];
   B  =  [  0.008000,  0.000000,
           0.000093,  0.000000];
   u  =  [  0.000000, 14.450000];
   C  =  [  1.000000,  1.000000];
   D  =  [  0.003000,  1.000000];
   x_dot  =  [  0.000000,  0.000000];
   y  =  [ 14.450000];
   AinvB =  [  0.001600,  0.000000,
           0.007700,  0.000000];
  ::Hysteresis:
  res=0.0150; Null, Ohm
  cap=  360000.0; F
  tau=    5400.0; Null, s
  ib=  0.000; In, A
  ioc=  0.000; Out, A
  soc=  1.0000; Input
  res=  0.015; Var, ohm
  dv_dot=  0.000; V/s
  dv_hys=  0.000; Delta state, V
  disabled=0; input < 1e-5
 *rp_hys_scale=  0.30; Slr
  r(soc, dv):
    y={  0.000,   0.500,   1.000, };
    x={ -0.900,  -0.700,  -0.500,  -0.300,   0.000,   0.300,   0.500,   0.700,   0.900, };
    v={
      {  0.000,   0.064,   0.050,   0.036,   0.015,   0.024,   0.030,   0.046,   0.000, },
      {  0.000,   0.000,   0.050,   0.036,   0.015,   0.024,   0.030,   0.000,   0.000, },
      {  0.000,   0.000,   0.000,   0.036,   0.015,   0.024,   0.000,   0.000,   0.000, },
      };
echo:  Pr, 0

retained parameters (rp):
  debug=0;*v<>
  delta_q=  0.000;*Ca<>
  t_last= 25.000; deg C
  delta_q_model=       0.0;*Ca<>,*Cm<>
  t_last_model= 25.000; deg C
  shunt_gain_sclr=   1.000; A
  ib_scale_amp=   0.892;*SA<> A
  ib_bias_amp=  -0.240;*DA<> A
  ib_scale_noa=   0.940;*SB<> A
  ib_bias_noa= -1.100;*DB<> A
  ib_bias_all=  0.000;*Di<> A 
  ib_select=0;*s<> -1=noa, 0=auto, 1=amp
  vb_bias=  1.500;*Dv,*Dc<> V
  modeling=15;*Xm<>
  amp=  0.000;*Xa<> A pk
  freq=  0.000;*Xf<> r/s
  type=1;*Xt<> 0=sin, 1=sq, 2=tri
  inj_bias=  0.000; A
  tb_bias_hdwe=  0.000;*Dt<> deg C
  s_cap_model=  1.000;*Sc<>
  cutback_gain_scalar=  1.000;*Sk<>
  isum=62;
  delta_q_cinf_amp=  -390240.0; C
  delta_q_dinf_amp=   390240.0; C
  delta_q_cinf_noa= -390240.0; C
  delta_q_dinf_noa=  390240.0; C
  hys_scale=  0.300;*Sh
  tweak_sclr_amp=  1.000;*Mk<>
  tweak_sclr_noa=  1.000;*Nk<>
  nP= 1.00;*BP<> e.g. '2P1S'
  nS= 1.00;*BS<> e.g. '2P1S'
  mon_mod=0;*Bm<> 0=Battle, 1=LION
  sim_mod=0;*Bs<> 0=Battle, 1=LION

command parameters(cp):
 enable_wifi=0; w
 model_cutback=1;
 model_saturated=1;
 soft_reset=0;
 write_summary=0;
 ib_tot_bias_amp=  0.000;
 ib_tot_bias_noa=  0.000;
 dc_dc_on=0;
 blynking=0; z
 publishS=1;
 tb_bias_mode=  0.000;
 s_t_sat=  1.000;
echo:  PM, 0

Tweak::Shunt(Amp)::
 port=0x49;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.892; A
 v2a_s=-272.05; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(Amp)::Tweak(Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.004564; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(Amp)::Adafruit_ADS1x15 (Amp):
 m_bitShift =      4;
 m_gain =       2048;
 s_gain =       1024;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (Amp):
  _addr =        0x49;
  _begun =          1;
  _maxBufferSize = 32;
Shunt(Amp)::
 port=0x49;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.892; A
 v2a_s=-272.05; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(Amp)::Tweak(Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.004565; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(Amp)::Adafruit_ADS1x15 (Amp):
 m_bitShift =      4;
 m_gain =       2048;
 s_gain =       1024;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (Amp):
  _addr =        0x49;
  _begun =          1;
  _maxBufferSize = 32;
echo:  PN, 0

Tweak::Shunt(No Amp)::
 port=0x48;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.940; A
 v2a_s=-1376.99; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(No Amp)::Tweak(No Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.004591; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(No Amp)::Adafruit_ADS1x15 (No Amp):
 m_bitShift =      4;
 m_gain =       2560;
 s_gain =       2560;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (No Amp):
  _addr =        0x48;
  _begun =          1;
  _maxBufferSize = 32;
Shunt(No Amp)::
 port=0x48;
 bare=0;
 *cp_ib_bias=  0.000; A
 *cp_ib_scale=  0.940; A
 v2a_s=-1376.99; A/V
 vshunt_int=0; count
 ishunt_cal=  0.000; A
 *rp_shunt_gain_sclr=  1.000; A
Shunt(No Amp)::Tweak(No Amp)::
  max_change=  0.004; 'N/MC'
  max_tweak=  0.040;  'N/Mx'
  rp_delta_q_cinf= -390240.0; 'N/Mi', Coulombs
  rp_delta_q_dinf=  390240.0; 'N/Mi', Coulombs
  sat=1; T=sat
  delta_hrs=  0.004593; 'N/Mz', hr
  time_to_wait=  0.000000; 'N/Mw', hr
  tweak_sclr=  1.000; 'N/Mk'
  coul_eff=  0.99850;
Shunt(No Amp)::Adafruit_ADS1x15 (No Amp):
 m_bitShift =      4;
 m_gain =       2560;
 s_gain =       2560;
 m_dataRate =    128;
Adafruit_ADS1x15::Adafruit_I2CDevice (No Amp):
  _addr =        0x48;
  _begun =          1;
  _maxBufferSize = 32;
echo:  Pf, 0

Sen::Fault:
 cc_diff   -0.000  thr=  0.200 Fc^
 ib_diff    0.000  thr= 10.000 Fd^
 e_wrap     0.000  thr=-246.000 Fo^393.600 Fi^
 ib_quiet   0.000  thr=  0.005 Fq v

 soc    1.000  voc  14.450  voc_soc  14.450
 dis_tb_fa 0  dis_vb_fa 0  dis_ib_fa 0
 bms_off   0

 Tbh=  0.000  Tbm= 25.000
 Vbh  13.204  Vbm  14.450
 imh   0.000  imm   0.000
 inh   0.000  inm   0.000

 mod_tb  1  mod_vb  1  mod_ib  1
 tb_s_st 1  vb_s_st 1  ib_s_st 1

 bare n  0  x 
 bare m  0  x 
 ib_dsc  0  0 'Fq v'
 ibd_lo  0  0 'Fd ^  *SA/*SB'
 ibd_hi  0  0 'Fd ^  *SA/*SB'
 loss wv 0  0   'Fd, Fi/Fo ^'
 wl      0  0 'Fo ^'
 wh      0  0 'Fi ^'
 cc_dif  x  0 'Fc ^'
 ib n    0  0 'Fi 1'
 ib m    0  0 'Fi 1'
 vb      0  0 'Fv 1  *Dc/*Dv'
 tb      0  0 'Ft 1'
  0000000000000   00000000000
  CBA98765x3210 xxA9876543210
  fltw=0     falw=0
echo:  Xs0.1, 0
s_t_sat     1.0 s to 
    0.1
echo:  Xf0.02, 0
Injected freq set   0.020 Hz =   0.126 r/s
echo:  XW5, 0
Wait     5.0 s to inj
echo:  XT5, 0
Wait     5.0 s tail after
echo:  Xa-6000, 0
Inj amp set -6000.000 & inj_bias set   0.000
echo:  XC20, 0
#inj cycles to  20.000
echo:  v0, 0
echo:  W2, 0
echo:  W, 0
..Wait.
echo:  W, 0
..Wait.
echo:  XR, 0
RUN: at 24788,  20.000 cycles 29788 to 1029788 with 5000 wait and 5000 tail
          Tweak(Amp)::ignore:, cinf= -390240.0, dinf=  383283.1, delta_soc=  0.000, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(No Amp)::ignore:, cinf= -390240.0, dinf=  383283.1, delta_soc=  0.000, coul_eff= 0.998500, scaler= 1.000000, effective coul_eff= 0.998500
          Tweak(Amp)::adjust:, cinf=   95348.5, dinf=  -95183.1, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.998855, effective coul_eff= 0.997357
          Tweak(No Amp)::adjust:, cinf=   95348.5, dinf=  -95183.1, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.998855, effective coul_eff= 0.997357
          Tweak(Amp)::adjust:, cinf=   95239.4, dinf=  -95189.6, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.998510, effective coul_eff= 0.997013
          Tweak(No Amp)::adjust:, cinf=   95239.4, dinf=  -95189.6, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.998510, effective coul_eff= 0.997013
          Tweak(Amp)::adjust:, cinf=   95208.3, dinf=  -95071.1, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.997560, effective coul_eff= 0.996064
          Tweak(No Amp)::adjust:, cinf=   95208.3, dinf=  -95071.1, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.997560, effective coul_eff= 0.996064
          Tweak(Amp)::adjust:, cinf=   95117.7, dinf=  -95207.4, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.998181, effective coul_eff= 0.996684
          Tweak(No Amp)::adjust:, cinf=   95117.7, dinf=  -95207.4, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.998181, effective coul_eff= 0.996684
          Tweak(Amp)::adjust:, cinf=   95176.9, dinf=  -95214.1, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.998439, effective coul_eff= 0.996941
          Tweak(No Amp)::adjust:, cinf=   95176.9, dinf=  -95214.1, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.998439, effective coul_eff= 0.996941
          Tweak(Amp)::adjust:, cinf=   95201.5, dinf=  -95220.8, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.998572, effective coul_eff= 0.997074
          Tweak(No Amp)::adjust:, cinf=   95201.5, dinf=  -95220.8, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.998572, effective coul_eff= 0.997074
          Tweak(Amp)::adjust:, cinf=   95214.2, dinf=  -95227.5, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.998664, effective coul_eff= 0.997166
          Tweak(No Amp)::adjust:, cinf=   95214.2, dinf=  -95227.5, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.998664, effective coul_eff= 0.997166
          Tweak(Amp)::adjust:, cinf=   95223.0, dinf=  -94981.8, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.996995, effective coul_eff= 0.995500
          Tweak(No Amp)::adjust:, cinf=   95223.0, dinf=  -94981.8, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.996995, effective coul_eff= 0.995500
          Tweak(Amp)::adjust:, cinf=   95063.8, dinf=  -95248.0, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.998270, effective coul_eff= 0.996772
          Tweak(No Amp)::adjust:, cinf=   95063.8, dinf=  -95248.0, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.998270, effective coul_eff= 0.996772
          Tweak(Amp)::adjust:, cinf=   95185.4, dinf=  -95023.1, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.997146, effective coul_eff= 0.995651
          Tweak(No Amp)::adjust:, cinf=   95185.4, dinf=  -95023.1, delta_soc= -0.244, coul_eff= 0.998500, scaler= 0.997146, effective coul_eff= 0.995651
echo:  XS, 4
echo:  XS, 0
STOP
echo:  Pr, 4
echo:  Pr, 0

retained parameters (rp):
  debug=0;*v<>
  delta_q=-95114.195;*Ca<>
  t_last= 25.000; deg C
  delta_q_model=  -95266.1;*Ca<>,*Cm<>
  t_last_model= 25.000; deg C
  shunt_gain_sclr=   1.000; A
  ib_scale_amp=   0.892;*SA<> A
  ib_bias_amp=  -0.240;*DA<> A
  ib_scale_noa=   0.940;*SB<> A
  ib_bias_noa= -1.100;*DB<> A
  ib_bias_all=  0.000;*Di<> A 
  ib_select=0;*s<> -1=noa, 0=auto, 1=amp
  vb_bias=  1.500;*Dv,*Dc<> V
  modeling=15;*Xm<>
  amp=-6000.000;*Xa<> A pk
  freq=  0.126;*Xf<> r/s
  type=1;*Xt<> 0=sin, 1=sq, 2=tri
  inj_bias=  0.000; A
  tb_bias_hdwe=  0.000;*Dt<> deg C
  s_cap_model=  1.000;*Sc<>
  cutback_gain_scalar=  1.000;*Sk<>
  isum=62;
  delta_q_cinf_amp=    95078.3; C
  delta_q_dinf_amp=  -185592.9; C
  delta_q_cinf_noa=   95078.3; C
  delta_q_dinf_noa= -185592.9; C
  hys_scale=  0.300;*Sh
  tweak_sclr_amp=  0.997;*Mk<>
  tweak_sclr_noa=  0.997;*Nk<>
  nP= 1.00;*BP<> e.g. '2P1S'
  nS= 1.00;*BS<> e.g. '2P1S'
  mon_mod=0;*Bm<> 0=Battle, 1=LION
  sim_mod=0;*Bs<> 0=Battle, 1=LION

command parameters(cp):
 enable_wifi=0; w
 model_cutback=0;
 model_saturated=0;
 soft_reset=0;
 write_summary=0;
 ib_tot_bias_amp=  0.000;
 ib_tot_bias_noa=  0.000;
 dc_dc_on=0;
 blynking=0; z
 publishS=0;
 tb_bias_mode=  0.000;
 s_t_sat=  0.100;
echo:  Pm, 4
echo:  Pm, 0
BM::Battery:
  temp_c= 25.000; dg C
 *rp_delt_q=  -95114.2;  C
 *rp_t_last=      25.0; dg C
  dvoc_dt=  0.004000; V/dg C
  r_0=  0.003000;  ohm
  r_ct =   0.001600;  ohm
  tau_ct=  0.200000;  s (=1/Rct/Cct)
  r_diff=  0.007700;  ohm
  tau_diff = 83.000000;  s (=1/Rdif/Cdif)
  r_sd =  70.000000;  ohm
  tau_sd=25000000.0;  s
  bms_off=0;
  dv_dsoc=  0.549889; V/frac
  ib=  0.000; A
  Ib=  0.000; Bank, A
  vb= 13.016; V
  Vb= 13.016; Bank, V
  voc= 13.077; V
  voc_stat= 13.151; V
  vsat= 13.800; V
  dv_dyn=  -0.061; V
  sr=  1.000; sclr
  dt=  0.100; s
 *rp_nP= 1.00; P bank, e.g. '2P1S'
 *rp_nS= 1.00; S bank, e.g. '2P1S'
 BM::BM:
  ah_rem_ekf_= 76.894; A-h
  ah_rem_soc_= 79.269; A-h
  EKF_conv=0;
  q_ekf=  286574.2; C
  soc_ekf=  0.7344; frac
  tcharge= 24.0; hr
  tcharge_ekf=  6.4; hr
  voc_filt= 13.125; V
  voc_stat= 13.151; V
  y_filt=  0.012; Res EKF, V
Coulombs:
 q_cap_rated= 390240.0; At t_rated, C
 q_cap_rated_scaled= 390240.0; Act at t_rated_, C
 q_capacity= 390240.0; Sat q at temp, C
 q= 295125.8; Avail, except q_min_, C
 q_min=   9756.0; Low volt shutdown, C
 delta_q -95114.2; Change since sat, C
 soc=  0.7563; Frac of q_cap avail (0-1);
 sat=0; T=saturated
 t_rated= 25.0; Rated, dg C
 t_last= 25.0; past, dg C
 t_rlim=  0.017; Tb RL, deg C / s
 resetting=0; Coord user testing of CC
 soc_min=  0.0250; soc BMS shuts off
 mod=Battleborn; Chem e.g. Battleborn or LION
 mod_code=0; Chem code
 coul_eff=  0.99850; Coul Eff
Coulombs::Chemistry:
  dqdt=  0.010; frac/dg C
  low_voc=  9.000; BMS turn off, V
  hys_cap=360000.000; F
  v_sat= 13.850; V
  dvoc_dt=  0.004; V/dg C
  dvoc= -0.050; Cal err, V
  Randles:   r_0= 0.003000; R0, ohm
   r_ct= 0.001600; Chg trans, ohm
   r_diff= 0.007700; Diffusion, ohm
   tau_ct=  0.200; ct, s (=1/Rct/Cct)
   tau_diff= 83.000; diff, s (=1/Rdiff/Cdiff)
  tau_sd=25000000.000; EKF. Parasitic disch, s
  r_sd= 70.000; EKF. Parasitic disch, ohm
  r_ss=  0.012; SS init, ohm
  voc(t, soc):
    y={  5.000,  11.100,  20.000,  30.000,  40.000, };
    x={ -0.150,   0.000,   0.050,   0.100,   0.140,   0.170,   0.200,   0.250,   0.300,   0.400,   0.500,   0.600,   0.700,   0.800,   0.900,   0.990,   0.995,   1.000, };
    v={
      {  4.000,   4.000,   4.000,   4.000,  10.200,  11.700,  12.450,  12.700,  12.770,  12.900,  12.910,  12.980,  13.050,  13.110,  13.170,  13.220,  13.590,  14.450, },
      {  4.000,   4.000,   4.000,   9.500,  12.000,  12.500,  12.700,  12.800,  12.900,  12.960,  13.010,  13.060,  13.110,  13.170,  13.200,  13.230,  13.600,  14.460, },
      {  4.000,   4.000,  10.000,  12.600,  12.770,  12.850,  12.890,  12.950,  12.990,  13.030,  13.040,  13.090,  13.140,  13.210,  13.250,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,  12.000,  12.650,  12.750,  12.800,  12.850,  12.950,  13.000,  13.080,  13.120,  13.160,  13.200,  13.240,  13.260,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,   4.000,   4.000,  10.500,  11.930,  12.780,  12.830,  12.890,  12.970,  13.060,  13.100,  13.130,  13.160,  13.190,  13.200,  13.720,  14.500, },
      };
  soc_min(temp_c):
    x={  5.000,  11.100,  20.000,  30.000,  40.000, };
    v={  0.100,   0.070,   0.050,   0.000,   0.200, };
StateSpace:
  dt =  0.100000
   A  =  [ -5.000000,  0.000000,
           0.000000, -0.012048];
   x  =  [  0.000000, -0.061263];
   B  =  [  0.008000,  0.000000,
           0.000093,  0.000000];
   u  =  [  0.000000, 13.015780];
   C  =  [ -1.000000, -1.000000];
   D  =  [ -0.003000,  1.000000];
   x_dot  =  [  0.000000,  0.000739];
   y  =  [ 13.077117];
   AinvB =  [  0.001600,  0.000000,
           0.007700,  0.000000];
  ::Hysteresis:
  res=0.0322; Null, Ohm
  cap=  360000.0; F
  tau=    5400.0; Null, s
  ib=  0.000; In, A
  ioc= -7.626; Out, A
  soc=  0.7563; Input
  res=  0.032; Var, ohm
  dv_dot=  0.000; V/s
  dv_hys= -0.245; Delta state, V
  disabled=0; input < 1e-5
 *rp_hys_scale=  0.30; Slr
  r(soc, dv):
    y={  0.000,   0.500,   1.000, };
    x={ -0.900,  -0.700,  -0.500,  -0.300,   0.000,   0.300,   0.500,   0.700,   0.900, };
    v={
      {  0.000,   0.064,   0.050,   0.036,   0.015,   0.024,   0.030,   0.046,   0.000, },
      {  0.000,   0.000,   0.050,   0.036,   0.015,   0.024,   0.030,   0.000,   0.000, },
      {  0.000,   0.000,   0.000,   0.036,   0.015,   0.024,   0.000,   0.000,   0.000, },
      };
EKF_1x1:
Inputs:
  z  =    13.1507;  // 1x1 input, =voc, dynamic predicted by other model, V
  R  =   0.250000;  // 1x1 Kalman state uncertainty
  Q  =   0.000000;  // 1x1 Kalman process uncertainty
  H  =      0.550;  // 1x1 Jacobian sensitivity dV/dSOC
Outputs:
  x  =     0.7344;  // 1x1 Kalman state variable = Vsoc (0-1 fraction)
  hx =    13.1389;  // Output of observation function h(x)
  y  =     0.0118;  // 1x1 Residual z-hx, V
  P  =   0.000010;  // 1x1 Kalman uncertainty covariance
  K  =   0.000023;  // 1x1 Kalman gain
  S  =   0.250003;  // 1x1 system uncertainty
echo:  Ps, 4
echo:  Ps, 0

modeling=15
S:BS::Battery:
  temp_c= 25.000; dg C
 *rp_delt_q=  -95266.1;  C
 *rp_t_last=      25.0; dg C
  dvoc_dt=  0.004000; V/dg C
  r_0=  0.003000;  ohm
  r_ct =   0.001600;  ohm
  tau_ct=  0.200000;  s (=1/Rct/Cct)
  r_diff=  0.007700;  ohm
  tau_diff = 83.000000;  s (=1/Rdif/Cdif)
  r_sd =  70.000000;  ohm
  tau_sd=25000000.0;  s
  bms_off=0;
  dv_dsoc=  0.549984; V/frac
  ib=  0.000; A
  Ib=  0.000; Bank, A
  vb= 13.027; V
  Vb= 13.027; Bank, V
  voc= 13.077; V
  voc_stat= 13.151; V
  vsat= 13.800; V
  dv_dyn=  -0.051; V
  sr=  1.000; sclr
  dt=  0.100; s
 *rp_nP= 1.00; P bank, e.g. '2P1S'
 *rp_nS= 1.00; S bank, e.g. '2P1S'
 BS::BS:
  sat_ib_max=  0.000; A
  sat_ib_null=  0.000; A
  sat_cutback_gain= 1000.0; voc>vsat
  model_cutback=0;
  model_saturated=0;
  ib=  0.000; A
  ib_in=  0.000; Saved, A
  ib_fut=  0.000; A
  ib_sat=  0.500;
 *rp_s_cap_model=  1.000; Slr
S::Coulombs:
 q_cap_rated= 390240.0; At t_rated, C
 q_cap_rated_scaled= 390240.0; Act at t_rated_, C
 q_capacity= 390240.0; Sat q at temp, C
 q= 390240.0; Avail, except q_min_, C
 q_min=   9756.0; Low volt shutdown, C
 delta_q -95266.1; Change since sat, C
 soc=  0.7559; Frac of q_cap avail (0-1);
 sat=0; T=saturated
 t_rated= 25.0; Rated, dg C
 t_last= 25.0; past, dg C
 t_rlim=  0.017; Tb RL, deg C / s
 resetting=0; Coord user testing of CC
 soc_min=  0.0250; soc BMS shuts off
 mod=Battleborn; Chem e.g. Battleborn or LION
 mod_code=0; Chem code
 coul_eff=  0.99850; Coul Eff
Coulombs::Chemistry:
  dqdt=  0.010; frac/dg C
  low_voc=  9.000; BMS turn off, V
  hys_cap=360000.000; F
  v_sat= 13.850; V
  dvoc_dt=  0.004; V/dg C
  dvoc= -0.050; Cal err, V
  Randles:   r_0= 0.003000; R0, ohm
   r_ct= 0.001600; Chg trans, ohm
   r_diff= 0.007700; Diffusion, ohm
   tau_ct=  0.200; ct, s (=1/Rct/Cct)
   tau_diff= 83.000; diff, s (=1/Rdiff/Cdiff)
  tau_sd=25000000.000; EKF. Parasitic disch, s
  r_sd= 70.000; EKF. Parasitic disch, ohm
  r_ss=  0.012; SS init, ohm
  voc(t, soc):
    y={  5.000,  11.100,  20.000,  30.000,  40.000, };
    x={ -0.150,   0.000,   0.050,   0.100,   0.140,   0.170,   0.200,   0.250,   0.300,   0.400,   0.500,   0.600,   0.700,   0.800,   0.900,   0.990,   0.995,   1.000, };
    v={
      {  4.000,   4.000,   4.000,   4.000,  10.200,  11.700,  12.450,  12.700,  12.770,  12.900,  12.910,  12.980,  13.050,  13.110,  13.170,  13.220,  13.590,  14.450, },
      {  4.000,   4.000,   4.000,   9.500,  12.000,  12.500,  12.700,  12.800,  12.900,  12.960,  13.010,  13.060,  13.110,  13.170,  13.200,  13.230,  13.600,  14.460, },
      {  4.000,   4.000,  10.000,  12.600,  12.770,  12.850,  12.890,  12.950,  12.990,  13.030,  13.040,  13.090,  13.140,  13.210,  13.250,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,  12.000,  12.650,  12.750,  12.800,  12.850,  12.950,  13.000,  13.080,  13.120,  13.160,  13.200,  13.240,  13.260,  13.270,  13.720,  14.500, },
      {  4.000,   4.000,   4.000,   4.000,  10.500,  11.930,  12.780,  12.830,  12.890,  12.970,  13.060,  13.100,  13.130,  13.160,  13.190,  13.200,  13.720,  14.500, },
      };
  soc_min(temp_c):
    x={  5.000,  11.100,  20.000,  30.000,  40.000, };
    v={  0.100,   0.070,   0.050,   0.000,   0.200, };
S::StateSpace:
  dt =  0.100000
   A  =  [ -5.000000,  0.000000,
           0.000000, -0.012048];
   x  =  [  0.000000, -0.050455];
   B  =  [  0.008000,  0.000000,
           0.000093,  0.000000];
   u  =  [  0.000000, 13.077220];
   C  =  [  1.000000,  1.000000];
   D  =  [  0.003000,  1.000000];
   x_dot  =  [  0.000000,  0.000609];
   y  =  [ 13.026704];
   AinvB =  [  0.001600,  0.000000,
           0.007700,  0.000000];
  ::Hysteresis:
  res=0.0322; Null, Ohm
  cap=  360000.0; F
  tau=    5400.0; Null, s
  ib=  0.000; In, A
  ioc= -7.621; Out, A
  soc=  0.7559; Input
  res=  0.032; Var, ohm
  dv_dot=  0.000; V/s
  dv_hys= -0.245; Delta state, V
  disabled=0; input < 1e-5
 *rp_hys_scale=  0.30; Slr
  r(soc, dv):
    y={  0.000,   0.500,   1.000, };
    x={ -0.900,  -0.700,  -0.500,  -0.300,   0.000,   0.300,   0.500,   0.700,   0.900, };
    v={
      {  0.000,   0.064,   0.050,   0.036,   0.015,   0.024,   0.030,   0.046,   0.000, },
      {  0.000,   0.000,   0.050,   0.036,   0.015,   0.024,   0.030,   0.000,   0.000, },
      {  0.000,   0.000,   0.000,   0.036,   0.015,   0.024,   0.000,   0.000,   0.000, },
      };
